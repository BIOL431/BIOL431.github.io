<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BIOL 431/531: Ecological Modeling - 6&nbsp; Components of linear models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab3.html" rel="next">
<link href="./simulation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./linearmodels.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Components of linear models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BIOL 431/531: Ecological Modeling</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to BIOL 431</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Thinking like a Modeler</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: Getting comfortable in R and RStudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hypotheses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hypotheses and Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lab 2: Data structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simulation and Probability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linearmodels.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Components of linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab 3: Functions and for loops</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 4: Data visualization</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#algebraic-linear-functions" id="toc-algebraic-linear-functions" class="nav-link active" data-scroll-target="#algebraic-linear-functions"><span class="header-section-number">6.1</span> Algebraic linear functions</a></li>
  <li><a href="#assumptions-of-linear-models" id="toc-assumptions-of-linear-models" class="nav-link" data-scroll-target="#assumptions-of-linear-models"><span class="header-section-number">6.2</span> Assumptions of linear models</a></li>
  <li><a href="#deterministic-and-stochastic-processes" id="toc-deterministic-and-stochastic-processes" class="nav-link" data-scroll-target="#deterministic-and-stochastic-processes"><span class="header-section-number">6.3</span> Deterministic and stochastic processes</a></li>
  <li><a href="#ordinary-least-squares" id="toc-ordinary-least-squares" class="nav-link" data-scroll-target="#ordinary-least-squares"><span class="header-section-number">6.4</span> Ordinary least squares</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting"><span class="header-section-number">7</span> Model fitting</a>
  <ul class="collapse">
  <li><a href="#recap-of-ols-and-residuals" id="toc-recap-of-ols-and-residuals" class="nav-link" data-scroll-target="#recap-of-ols-and-residuals"><span class="header-section-number">7.1</span> Recap of OLS and residuals</a></li>
  <li><a href="#american-bison-example" id="toc-american-bison-example" class="nav-link" data-scroll-target="#american-bison-example"><span class="header-section-number">7.2</span> American bison example</a></li>
  <li><a href="#the-design-matrix" id="toc-the-design-matrix" class="nav-link" data-scroll-target="#the-design-matrix"><span class="header-section-number">7.3</span> The Design Matrix</a>
  <ul class="collapse">
  <li><a href="#adding-matrices" id="toc-adding-matrices" class="nav-link" data-scroll-target="#adding-matrices"><span class="header-section-number">7.3.1</span> Adding matrices</a></li>
  <li><a href="#multiplying-vectors-and-matrices" id="toc-multiplying-vectors-and-matrices" class="nav-link" data-scroll-target="#multiplying-vectors-and-matrices"><span class="header-section-number">7.3.2</span> Multiplying vectors and matrices</a></li>
  </ul></li>
  <li><a href="#fitting-a-simple-linear-model" id="toc-fitting-a-simple-linear-model" class="nav-link" data-scroll-target="#fitting-a-simple-linear-model"><span class="header-section-number">7.4</span> Fitting a simple linear model</a></li>
  </ul></li>
  <li><a href="#evaluating-model-fit" id="toc-evaluating-model-fit" class="nav-link" data-scroll-target="#evaluating-model-fit"><span class="header-section-number">8</span> Evaluating model fit</a>
  <ul class="collapse">
  <li><a href="#assumptions-of-linear-models-1" id="toc-assumptions-of-linear-models-1" class="nav-link" data-scroll-target="#assumptions-of-linear-models-1"><span class="header-section-number">8.1</span> Assumptions of linear models</a>
  <ul class="collapse">
  <li><a href="#the-model-makes-biological-sense" id="toc-the-model-makes-biological-sense" class="nav-link" data-scroll-target="#the-model-makes-biological-sense"><span class="header-section-number">8.1.1</span> The model makes biological sense</a></li>
  <li><a href="#the-effects-are-additive" id="toc-the-effects-are-additive" class="nav-link" data-scroll-target="#the-effects-are-additive"><span class="header-section-number">8.1.2</span> The effects are additive</a></li>
  <li><a href="#effects-are-linear" id="toc-effects-are-linear" class="nav-link" data-scroll-target="#effects-are-linear"><span class="header-section-number">8.1.3</span> Effects are linear</a></li>
  <li><a href="#errors-are-independent" id="toc-errors-are-independent" class="nav-link" data-scroll-target="#errors-are-independent"><span class="header-section-number">8.1.4</span> Errors are independent</a></li>
  <li><a href="#errors-have-equal-variance-homoscedasticity" id="toc-errors-have-equal-variance-homoscedasticity" class="nav-link" data-scroll-target="#errors-have-equal-variance-homoscedasticity"><span class="header-section-number">8.1.5</span> Errors have equal variance (homoscedasticity)</a></li>
  <li><a href="#errors-are-normally-distributed" id="toc-errors-are-normally-distributed" class="nav-link" data-scroll-target="#errors-are-normally-distributed"><span class="header-section-number">8.1.6</span> Errors are normally distributed</a></li>
  </ul></li>
  <li><a href="#diagnostic-plots-in-r" id="toc-diagnostic-plots-in-r" class="nav-link" data-scroll-target="#diagnostic-plots-in-r"><span class="header-section-number">8.2</span> Diagnostic plots in R</a></li>
  <li><a href="#what-about-the-data" id="toc-what-about-the-data" class="nav-link" data-scroll-target="#what-about-the-data"><span class="header-section-number">8.3</span> What about the data?</a></li>
  <li><a href="#overparameterizing" id="toc-overparameterizing" class="nav-link" data-scroll-target="#overparameterizing"><span class="header-section-number">8.4</span> Overparameterizing</a></li>
  <li><a href="#within--and-out-of-sample-prediction" id="toc-within--and-out-of-sample-prediction" class="nav-link" data-scroll-target="#within--and-out-of-sample-prediction"><span class="header-section-number">8.5</span> Within- and out-of-sample prediction</a></li>
  </ul></li>
  <li><a href="#prediction-and-inference" id="toc-prediction-and-inference" class="nav-link" data-scroll-target="#prediction-and-inference"><span class="header-section-number">9</span> Prediction and inference</a>
  <ul class="collapse">
  <li><a href="#interpreting-coefficients" id="toc-interpreting-coefficients" class="nav-link" data-scroll-target="#interpreting-coefficients"><span class="header-section-number">9.1</span> Interpreting coefficients</a></li>
  <li><a href="#predicting" id="toc-predicting" class="nav-link" data-scroll-target="#predicting"><span class="header-section-number">9.2</span> Predicting</a></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals"><span class="header-section-number">9.3</span> Confidence intervals</a>
  <ul class="collapse">
  <li><a href="#predicting-with-se" id="toc-predicting-with-se" class="nav-link" data-scroll-target="#predicting-with-se"><span class="header-section-number">9.3.1</span> Predicting with SE</a></li>
  </ul></li>
  <li><a href="#extrapolating" id="toc-extrapolating" class="nav-link" data-scroll-target="#extrapolating"><span class="header-section-number">9.4</span> Extrapolating</a></li>
  </ul></li>
  <li><a href="#bringing-it-all-together" id="toc-bringing-it-all-together" class="nav-link" data-scroll-target="#bringing-it-all-together"><span class="header-section-number">10</span> Bringing it all together</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Components of linear models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Linear models are the bread and butter of ecological modeling. If you can fit a linear model, you can satisfactorily answer probably over 90% of the types of questions ecologists are interested in. They also include the basic building structures for almost all types of models in ecology, and the skills you would need to learn other ones, so this is why we will spend two weeks covering them.</p>
<section id="algebraic-linear-functions" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="algebraic-linear-functions"><span class="header-section-number">6.1</span> Algebraic linear functions</h2>
<p>There are a few important things to remember from your first algebra class that will be important for linear models.</p>
<p>Remember that we can represent a straight line in slope-intercept form as <span class="math inline">\(y = mx + b\)</span>, where <span class="math inline">\(m\)</span> is the slope of the line and <span class="math inline">\(b\)</span> is the intercept. The intercept, <span class="math inline">\(b\)</span> is where the line hits the y-axis, in other words, it is the value of <span class="math inline">\(y\)</span> when <span class="math inline">\(x=0\)</span>. For every one unit increase in <span class="math inline">\(x\)</span>, we except an <span class="math inline">\(m\)</span> unit increase in <span class="math inline">\(y\)</span>.</p>
<p>We represent the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> in a Cartesian plane, where the <span class="math inline">\(x\)</span> axis is horizontal and the <span class="math inline">\(y\)</span> axis is vertical (and we are only operating in two dimensions).</p>
<p>In a function, no single <span class="math inline">\(x\)</span> value as input can have two different <span class="math inline">\(y\)</span> values as output. In other words, a function can never double back on itself / overlap vertically. If you know <span class="math inline">\(x\)</span>, you know <span class="math inline">\(y\)</span> - there is no possibility of a different <span class="math inline">\(y\)</span> associated with a single <span class="math inline">\(y\)</span>. The same <span class="math inline">\(y\)</span> value can be the output of multiple different <span class="math inline">\(x\)</span> input values, though.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.boredpanda.com/blog/wp-content/uploads/2023/06/funny-witty-math-memes-56-6489a7a911599__700.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Functional cows</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/nonfunctionalcow.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Non-functional cow, input of x = 1 leads to y = 1.5 and y = -4</figcaption>
</figure>
</div>
<p>Normal linear functions are continuous with no break points / gaps. There are piecewise functions over which there are ranges of <span class="math inline">\(x\)</span> values that there can be no <span class="math inline">\(y\)</span> values, but these are not the norm. For this class, we are only going to use normal linear functions that are not piece-wise. If you’re interested in piece-wise type questions, you might also be interested in <a href="https://en.wikipedia.org/wiki/Hurdle_model">hurdle models</a>.</p>
<p><img src="https://justinmath.com/files/blog/piecewise-functions-2.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Note on terminology. Some people refer to variable(s) on the x-axis as the independent variable and the variable on the y-axis as the dependent variable because y depends on x. This is confusing, however, and also implies that there is a strongly causal relationship between x and y. I, and many others, prefer the terms predictor for the x-axis variable(s), and response for the y-axis variable because these terms are much clearer for communicating your model structure.</p>
</blockquote>
</section>
<section id="assumptions-of-linear-models" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="assumptions-of-linear-models"><span class="header-section-number">6.2</span> Assumptions of linear models</h2>
<p>All models have assumptions. These are conditions that <em>should</em> be met by your model in order for you to trust the inference you make based on it. If these assumptions are not met, take your model outputs with a grain of salt (or don’t believe them, depending on how badly you don’t meet the assumptions!).</p>
<ol type="1">
<li><p>It makes <em>biological sense</em>. This is the single most important assumption of your model. Your predictors must make sense in how they relate to your response variable, your underlying deterministic component is sensible, and you have a biological hypothesis or explanation for why you are using this model structure.</p></li>
<li><p>The effects are <em>additive</em>. In our simple model, the response variable is the sum of the intercept (<span class="math inline">\(b\)</span>) and the slope (<span class="math inline">\(m\)</span>) times the value of <span class="math inline">\(x\)</span>, not the product of the two, or <span class="math inline">\(m\)</span> as a function of <span class="math inline">\(x\)</span>, etc. The effects are additive because they are separate and the sum of the effects results in the deterministic estimate.</p></li>
<li><p>Effects are <em>linear</em>. This does not mean that everything needs to be a straight line! But the function does need to be linear.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's explore some linear functions</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.formula(x ~ x, type = "l"): the formula 'x ~ x' is treated as
'x ~ 1'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">~</span>x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span><span class="dv">3</span> <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span><span class="dv">4</span> <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span><span class="dv">5</span> <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>x) <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">/</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sin</span>(x) <span class="sc">~</span> x, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-1-9.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="4" type="1">
<li><p>Errors (aka residuals, in this case) are independent. There are no shared patterns in the residuals, which might indicate that there is an issue with the observation process, or that there are other shared covariates that might explain patterns in the residuals.</p></li>
<li><p>Errors have equal variance (“homoscedasticity”).</p></li>
<li><p>Errors are normally distributed. The residuals of the model are not skewed, non-normal, all positive, etc.</p></li>
</ol>
</section>
<section id="deterministic-and-stochastic-processes" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="deterministic-and-stochastic-processes"><span class="header-section-number">6.3</span> Deterministic and stochastic processes</h2>
<p>Linear models consist of a deterministic component and a stochastic component. For a normally distributed random variable <span class="math inline">\(y\)</span> with one predictor <span class="math inline">\(x_1\)</span>, the (a) stochastic and (b) deterministic components can be represented as: <span class="math display">\[\text{(a)} \quad y \sim Norm(\mu, \sigma) \\ \text{(b)} \quad \mu = \beta_0 + \beta_1*x_1\]</span> In this example, you can think of <span class="math inline">\(\beta_0\)</span> as the same as <span class="math inline">\(b\)</span> in <span class="math inline">\(y = mx + b\)</span> and the coefficient <span class="math inline">\(\beta_1\)</span> as the slope <span class="math inline">\(m\)</span>. But, the general linear model is a lot more flexible than a linear function represented in slope-intercept form (so we will switch to the more accurate representation for the rest of the semester).</p>
<p>The <strong>deterministic</strong> component will always result in the same answer every time (i.e., it is determined). This is akin to an algebraic linear function, i.e.&nbsp;the y-value always lies on the line. In ecology, the deterministic component represents our biological hypothesis, i.e.&nbsp;it is a statement about the way we think the world works. If the world worked the way we think it does, every time we would end up observing the same outcome. Note that the deterministic component uses <span class="math inline">\(=\)</span> because the answer is solvable.</p>
<p>Because there is always some amount of error or variation around that deterministic part, we also have a <strong>stochastic</strong> component. The stochastic component can represent a number of things depending on what you are modeling. It could be measurement or observation error, e.g.&nbsp;because we imperfectly observe the world, miscount individuals, our measurement tools are a bit faulty, etc. It could also represent true biological variability around a population mean (e.g.&nbsp;think about intraspecific trait variability). Or, it could represent unmeasured or unmodeled variables (i.e., the variable we are modeling is predicted by two covariates, but we only included one, so we are working with an incomplete picture). And, of course, it could be a combination of these different factors. Note that the stochastic component uses <span class="math inline">\(\sim\)</span> because the output is distributed as that probability distribution, but we know there will always be variation in our sample.</p>
</section>
<section id="ordinary-least-squares" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="ordinary-least-squares"><span class="header-section-number">6.4</span> Ordinary least squares</h2>
<p>In an algebraic linear function represented in slope-intercept form, all values of <span class="math inline">\(y\)</span> lie on the line, with no deviation from it. In the real world, data are messy, so how do we find the line of best fit through that data? Typically, we use ordinary least squares (OLS) regression. You can think of it as if we are attempting to find the combination of the slope (<span class="math inline">\(m\)</span>) and intercept (<span class="math inline">\(b\)</span>) that leads to a line that is as close as possible to all data points. In other words, we want to have the smallest <em>residuals</em> (the difference between each point and the predicted value on the line) as possible. In reality, we base this fit on the sum of the squared residuals. Why squared? Let’s simulate some data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let's create a function that generates observations as a linear function </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of x, i.e. in an algebraic sense</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>linear_function <span class="ot">&lt;-</span> <span class="cf">function</span>(m, x, b){</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> m<span class="sc">*</span>x <span class="sc">+</span> b</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>x.vals <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>y.det <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m =</span> slope, <span class="at">x=</span>x.vals, <span class="at">b=</span>intercept)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.det <span class="sc">~</span> x.vals)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(y.det <span class="sc">~</span> x.vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's add error</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">27</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>y.obs <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(y.det), <span class="at">mean =</span> y.det, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.obs <span class="sc">~</span> x.vals, <span class="at">type=</span><span class="st">"p"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(y.det <span class="sc">~</span> x.vals)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> x.vals, <span class="at">x1=</span>x.vals,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y0=</span>y.det, <span class="at">y1=</span>y.obs, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">code=</span><span class="dv">3</span>, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">angle=</span><span class="dv">90</span>, </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">length=</span><span class="dv">0</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the residuals</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> y.obs <span class="sc">-</span> y.det</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(res<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.89237</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what if we tried a different line?</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>alt.line <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m=</span><span class="fl">0.05</span>, <span class="at">x=</span>x.vals, <span class="at">b=</span><span class="dv">2</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.obs <span class="sc">~</span> x.vals)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(alt.line <span class="sc">~</span> x.vals)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> x.vals, <span class="at">x1=</span>x.vals,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y0=</span>alt.line, <span class="at">y1=</span>y.obs, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">code=</span><span class="dv">3</span>, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">angle=</span><span class="dv">90</span>, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">length=</span><span class="dv">0</span>, </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> y.obs <span class="sc">-</span> alt.line</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(res2<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.02767</code></pre>
</div>
</div>
<p>Because we simulated based on the deterministic relationship but added in error, neither of these attempts is actually the line of best fit for our ‘observed’ data. Let’s build a for-loop that will let us try a bunch of different potential slopes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>potential_m <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ssr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(potential_m)){</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  line_i <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m =</span> potential_m[i], <span class="at">x =</span> x.vals, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  res_i <span class="ot">&lt;-</span> y.obs <span class="sc">-</span> line_i</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  ssr[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(res_i<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ssr <span class="sc">~</span> potential_m, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(ssr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>potential_m[<span class="fu">which.min</span>(ssr)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>est_line <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m =</span> <span class="fl">0.4</span>, <span class="at">x=</span>x.vals, <span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.obs <span class="sc">~</span> x.vals)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(est_line <span class="sc">~</span> x.vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># so far, we fixed the intercept at 0 and tried slopes based on that</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># what if we want to estimate both the slope and intercept parameter?</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>potential_b <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ssr2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">length</span>(potential_m), <span class="at">ncol=</span><span class="fu">length</span>(potential_b))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(potential_m)){</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(potential_b)){</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>      line_i <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m =</span> potential_m[i], <span class="at">x =</span> x.vals, <span class="at">b=</span>potential_b[j])</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>      res_i <span class="ot">&lt;-</span> y.obs <span class="sc">-</span> line_i</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>      ssr2[i, j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(res_i<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the likelihood surface</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(ssr2, <span class="at">Rowv =</span> <span class="cn">NA</span>, <span class="at">Colv =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(ssr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.63746</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(ssr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ssr2<span class="sc">==</span><span class="fu">min</span>(ssr2), <span class="at">arr.ind =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     row col
[1,]  23  47</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>potential_m[<span class="dv">23</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>potential_b[<span class="dv">47</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Are these what we actually set earlier? No, because we included a bit of stochasticity in our data generating process</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realistically, we rarely (if ever?) actually brute force our way to a combination of parameters that minimizes the sum of the squared residuals. Instead, we use built-in functions to do that for us. We will use the function <code>lm</code> to fit a linear model to our simulated data which has a slope and intercept that minimize the sum of the squared residuals. The argument that the function needs is a formula, which we represent as our response variable over our predictor variable(s) using the tilde (i.e.&nbsp;<code>y ~ x</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.obs <span class="sc">~</span> x.vals)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y.obs ~ x.vals)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.7480 -0.8622 -0.2009  0.8796  1.7493 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   1.3137     0.8860   1.483    0.176
x.vals        0.2442     0.1428   1.710    0.126

Residual standard error: 1.297 on 8 degrees of freedom
Multiple R-squared:  0.2677,    Adjusted R-squared:  0.1762 
F-statistic: 2.925 on 1 and 8 DF,  p-value: 0.1256</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From our "observed" data, the best line has slope=0.2442 and intercept=1.3137</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's double check this with our function and residuals</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ols.line <span class="ot">&lt;-</span> <span class="fu">linear_function</span>(<span class="at">m=</span><span class="fl">0.2442</span>, <span class="at">x=</span>x.vals, <span class="at">b=</span><span class="fl">1.3137</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.obs <span class="sc">~</span> x.vals)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ols.line <span class="sc">~</span> x.vals)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> x.vals, <span class="at">x1=</span>x.vals,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y0=</span>ols.line, <span class="at">y1=</span>y.obs, </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">code=</span><span class="dv">3</span>, </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">angle=</span><span class="dv">90</span>, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">length=</span><span class="dv">0</span>, </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>res.ols <span class="ot">&lt;-</span> y.obs <span class="sc">-</span> ols.line</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(res.ols<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.45756</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(res.ols) <span class="co"># Not actually zero because of rounding, but, very very close</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0006278831</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Why doesn't this match what we got in our brute force approach?</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># What would happen if we increased the number of parameters we checked with brute force?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fitting" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Model fitting</h1>
<section id="recap-of-ols-and-residuals" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="recap-of-ols-and-residuals"><span class="header-section-number">7.1</span> Recap of OLS and residuals</h2>
<p>Remember from the previous lecture that a simple way to fit a linear model to data is to use ordinary least squares (OLS) regression and minimize the sum of the squared residuals. We did this a brute force approach by trying combinations of parameter values that resulted in a linear model that minimized the sum of the squared residuals <strong>for the parameter values that we tried</strong>. Note that this last point is very important: we did not try all possible combinations of parameters, so even though we may have found a locally optimal solution, we could have missed the actual optimal solution.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.researchgate.net/publication/45900660/figure/fig3/AS:667768525443076@1536219831231/A-typical-energy-landscape-depicting-position-of-several-local-minima-which-indicate-the.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Local versus global minimum</figcaption>
</figure>
</div>
<p>For normally distributed errors, OLS is essentially a special case of maximum likelihood estimation (MLE). Maximum likelihood attempts to find the parameter combination that makes our observed data most probable. But, the likelihood function (not in the R function sense, but in the math function sense) can get stuck at local optima. Think of it sort of like a blindfolded person walking around a field trying to find the lowest point. If they keep walking downhill, eventually they will find themselves at the bottom. If any step they take in any direction is uphill, then they should stop where they are. This approach works fine if there is only one low point in the field, but not if there are multiple depressions. What if they’re just stuck in a bison wallow?</p>
</section>
<section id="american-bison-example" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="american-bison-example"><span class="header-section-number">7.2</span> American bison example</h2>
<p>For today’s lecture and next week, we will be using a dataset of bison ages and weights collected at the Konza Prairie LTER site. Let’s start by watching a video of bison to remind ourselves just how massive they are. When watching the video, pay careful attention specifically to the size (and approximate weight) of bison of different ages and different sexes, and anything that might affect an individual’s weight.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3bS6Dz4YVqQ?si=ZhsxZlEi_wgqRMuV&amp;start=4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://tinyurl.com/bigbison"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  DataCode RecType RecYear RecMonth RecDay AnimalCode AnimalSex AnimalWeight
1    CBH01       2    1994       11      8        813         F          890
2    CBH01       2    1994       11      8        834         F         1074
3    CBH01       2    1994       11      8      B-301         F         1060
4    CBH01       2    1994       11      8      B-402         F          989
5    CBH01       2    1994       11      8      B-403         F         1062
6    CBH01       2    1994       11      8      B-502         F          978
  AnimalYOB
1      1981
2      1983
3      1983
4      1984
5      1984
6      1985</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate age</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>age <span class="ot">&lt;-</span> dat<span class="sc">$</span>RecYear <span class="sc">-</span> dat<span class="sc">$</span>AnimalYOB <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sort with oldest bison at the top</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="fu">order</span>(dat<span class="sc">$</span>age, <span class="at">decreasing =</span> T),]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># remove duplicates of the same individual</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># because we sorted by age first, we are keeping the oldest record per individual</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="sc">!</span><span class="fu">duplicated</span>(dat<span class="sc">$</span>AnimalCode),]</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat<span class="sc">$</span>AnimalWeight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>AnimalWeight),]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>AnimalSex)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>weight <span class="sc">~</span> dat<span class="sc">$</span>age, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span>dat<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s say we are interested in fitting a model of the effect of age and sex on bison weight. We assume that our response variable (weight) is normally distributed. The deterministic and stochastic components of our model can be written as:</p>
<p><span class="math display">\[y \sim Norm(\mu, sigma)\]</span> <span class="math display">\[\mu = \beta_0 + \beta_{a}*age + \beta_{s}*sex\]</span></p>
<p>When we perform OLS to find a combination of parameters that makes our observed data the most likely, we are attempting to find the combination of our three coefficients <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_a\)</span> and <span class="math inline">\(\beta_s\)</span>. When fitting the model, our coefficient estimates will now be the best combination of values for all three coefficients (i.e.&nbsp;the intercept, <span class="math inline">\(\beta_0\)</span>, the effect of age, <span class="math inline">\(\beta_{a}\)</span>, and the effect of sex <span class="math inline">\(\beta_{s}\)</span>) that minimizes the sum of the squared residuals.</p>
</section>
<section id="the-design-matrix" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="the-design-matrix"><span class="header-section-number">7.3</span> The Design Matrix</h2>
<p>To understand why we get a combination of three coefficients that collectively minimize the sum of the squared residuals, rather than estimating the effect of each predictor separately, it is important to know just a <em>little</em> bit of matrix algebra. The three coefficient estimates (or ‘betas’ for short) are a <strong>vector</strong>, which has only one dimension and all elements are of the same type (typically, numeric).</p>
<p>A matrix, while still having elements of the same type, has two dimensions: the number of rows, and the number of columns. In ecological modeling, people typically either describe a matrix as being <span class="math inline">\(n \times p\)</span>, where <span class="math inline">\(n\)</span> is the number of rows or number of observations and <span class="math inline">\(p\)</span> is the number of predictors, or as being <span class="math inline">\(i \times j\)</span> where <span class="math inline">\(i\)</span> is the number of observations and <span class="math inline">\(j\)</span> is the number of predictors. I tend to use <span class="math inline">\(i \times j\)</span> because it matches how I code indices (i.e.&nbsp;<code>x[i]</code>) and because very rarely are biological concepts denoted as <span class="math inline">\(i\)</span> or <span class="math inline">\(j\)</span> but <span class="math inline">\(n\)</span> often is used to describe sample sizes and <span class="math inline">\(p\)</span> is often used for probability, so I find the code is much more readable with <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<section id="adding-matrices" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="adding-matrices"><span class="header-section-number">7.3.1</span> Adding matrices</h3>
<p>Let’s say we have the following 2x3 matrices <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. To add the two matrices together, we add the matching elements from each. We can only add the matrices together if they have the same dimensionality, i.e.&nbsp;we could not add a 2x3 matrix to a 2x5 matrix because there will not be matching elements.</p>
<p><span class="math display">\[A = \begin{bmatrix}
2 &amp; 4 &amp; 3 \\
1&amp;6 &amp; 8
\end{bmatrix} \\
\\
B= \begin{bmatrix}
1 &amp; 2&amp;3\\
5&amp;8&amp;1
\end{bmatrix}
\\ \\
A+B = \begin{bmatrix}
(2+1) &amp; (4+2) &amp; (3+3)\\
(1+5) &amp; (6+8) &amp; (8+1)
\end{bmatrix}
\\
A+B = \begin{bmatrix}
3 &amp; 6 &amp; 6 \\
6 &amp; 14 &amp; 9
\end{bmatrix}\]</span></p>
<p>We can also do matrix calculations in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrix A</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">8</span>), </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">3</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">byrow=</span>T <span class="co"># super important! default is to fill by column</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">3</span>, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">byrow=</span>T)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>A<span class="sc">+</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    3    6    6
[2,]    6   14    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what if we mad matrices with different dimensions?</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="co"># note we now have a 3x2 matrix!</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">byrow=</span>T</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    1    1
[3,]    0    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A+C # this will result in an error because they have different dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multiplying-vectors-and-matrices" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="multiplying-vectors-and-matrices"><span class="header-section-number">7.3.2</span> Multiplying vectors and matrices</h3>
<p>When multiplying matrices and vectors in <code>R</code>, we use the <code>%*%</code> operator, rather than <code>*</code>. When multiplying a vector by a matrix, the vector needs to have the same length as the number of columns in the matrix. One thing that is perhaps counterintuitive here is that vectors are oriented like columns so the length is vertical. But, when viewed in R, they will look horizontal.</p>
$$ =
<span class="math display">\[\begin{bmatrix}
0 \\ 1 \\ 0.5 \\
\end{bmatrix}\]</span>
\ A =
<span class="math display">\[\begin{bmatrix}
2 &amp; 4 &amp; 3 \\
1&amp;6 &amp; 8
\end{bmatrix}\]</span>
<p>\</p>
A =
<span class="math display">\[\begin{bmatrix}
(0\times2) + (1\times4) + (0.5\times3)\\
(0\times1) + (1\times6) + (0.5\times8)
\end{bmatrix}\]</span>
=
<span class="math display">\[\begin{bmatrix}
0 + 4 + 1.5\\
0 + 6 + 4
\end{bmatrix}\]</span>
=
<span class="math display">\[\begin{bmatrix}
5.5 \\ 10
\end{bmatrix}\]</span>
<p>$$</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>A<span class="sc">%*%</span>betas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]  5.5
[2,] 10.0</code></pre>
</div>
</div>
<p>This is where our Design Matrix comes in, where the number of columns needs to be equal to our number of betas, and the number of rows needs to be equal to the number of observations. Don’t forget to add a column of all 1s if you have an intercept! i.e.&nbsp;so that the intercept <span class="math inline">\(\beta_0\)</span> gets multiplied by <span class="math inline">\(1\)</span> and added in each time.</p>
<p><span class="math display">\[ \begin{bmatrix}
\beta_0 \\ \beta_1 \\ \beta_2 \\ \vdots \\ \beta_j
\end{bmatrix} *
\begin{bmatrix}
1 &amp; x_{1,1} &amp; x_{1,2} &amp; \dots &amp; x_{1,j} \\
1 &amp; x_{2,1} &amp; x_{2,2} &amp; \dots &amp; x_{2,j} \\
\vdots &amp; \vdots &amp; &amp; \vdots \\
1 &amp; x_{i,1} &amp; x_{i,2} &amp; \dots &amp; x_{i,j} \\\end{bmatrix}
=
\begin{bmatrix}
\mu_1 \\ \mu_2 \\ \vdots \\ \mu_i
\end{bmatrix}\]</span></p>
<p><span class="math display">\[ \mu_i = \beta_0*1 + \beta_1*x_{i,1} + \beta_2*x_{i,2} \dots + \beta_j*x_{i,j}\]</span></p>
</section>
</section>
<section id="fitting-a-simple-linear-model" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="fitting-a-simple-linear-model"><span class="header-section-number">7.4</span> Fitting a simple linear model</h2>
<p>Instead of going through the whole painful process of OLS every time we want to fit a model, R has a built in function called <code>lm</code> which will run a linear model for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data=</span>dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we get to model fit, we will go over interpreting coefficient estimates for categorical variables. In our dataset, sex is coded as M or F. Behind the scenes, R has automatically dummy-coded these for you. Dummy-coding is when you represent a categorical variable as 0 or 1, so there is a new temporary ‘column’ (not really, but thinking of it like that will be helpful) in our dataset called ‘M’ and it takes the value of 1 when the sex column is M, and 0 when it does not. There is also a new temporary ‘column’ called F that scales the value of 1 when sex is F, and 0 when it is not.</p>
<p>When dealing with categorical variables, there always has to be a comparison level that other levels are compared to because it is incorporated into the intercept. The default in R is the first value alphabetically. Let’s look at the summary of the model to help with understanding this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age + sex, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-835.03 -141.93  -19.71  125.43  961.16 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  404.216      9.585   42.17   &lt;2e-16 ***
age           58.855      1.328   44.32   &lt;2e-16 ***
sexM         213.787     10.183   21.00   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 235.2 on 2282 degrees of freedom
  (43 observations deleted due to missingness)
Multiple R-squared:  0.475, Adjusted R-squared:  0.4745 
F-statistic:  1032 on 2 and 2282 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We have a coefficient estimate for the intercept, for age, and for sex = M. There is no coefficient estimate for sex = F. That’s because the intercept now represents the predicted weight for a <em>female</em> bison at age 0. The coefficient estimate for sex = Mrepresents the difference in the intercept for a male bison <em>still at age 0</em>, i.e.&nbsp;it shifts the entire line up the y-axis by that amount.</p>
<blockquote class="blockquote">
<p>As a side note that does not apply to this model but will come up in the future: if you have multiple categorical variables, the intercept is the comparison level for all of them. i.e.&nbsp;if we also had bison color morphs that were aqua and chartreuse, the intercept would be the predicted weight for an aqua-colored female bison at age 0 (because aqua alphabetically comes first). You can change what the comparison level is by converting categorical variables into factors with <code>factor</code> and using <code>relevel</code> to specify the order.</p>
</blockquote>
<p>Let’s plot the predictions from the model to help with understanding the different coefficient estimates by visualizing the model (we will come back to model fit later!). Now, one obnoxious thing about plotting models fit with dummy variables, is that to predict new values, we need to be able to pass in a 0 or 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat<span class="sc">$</span>AnimalSex<span class="sc">==</span><span class="st">"M"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data=</span>dat)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>des.mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, dat<span class="sc">$</span>age, dat<span class="sc">$</span>sex)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(mod1)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>est.vals <span class="ot">&lt;-</span> des.mat<span class="sc">%*%</span>betas</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>age.range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">22</span>, <span class="fl">0.1</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>des.mat.f <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, age.range, <span class="dv">0</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>des.mat.m <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, age.range, <span class="dv">1</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>f.ests <span class="ot">&lt;-</span> des.mat.f<span class="sc">%*%</span>betas</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>m.ests <span class="ot">&lt;-</span> des.mat.m<span class="sc">%*%</span>betas</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data =</span> dat, <span class="at">col=</span><span class="fu">factor</span>(dat<span class="sc">$</span>sex))</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(f.ests <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(m.ests <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Okay, so I think we can all agree something seems <strong>very</strong> off about our model. We don’t even need diagnostic plots to know this is not a good representation of our data. In reality, animals do not continue to grow at at the same rate with age (though many fish do have indeterminate growth), and weight will eventually plateau.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.mercurynews.com/wp-content/uploads/2022/11/hypatia-h_43d6427768a315f7d9230a00c8cdd3d3-h_7138ac0ed4cc1e068d401b99c60ec1bb.jpg?w=1024" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Even fish with indeterminate growth do not grow linearly with age</figcaption>
</figure>
</div>
<p>Remember that a linear model does not have to be a straight line! Any linear function of x will do. In this case, we want something that will reach a horizontal asymptote. <span class="math inline">\(x^{1/2}\)</span> should do the trick here. If you’re not sure what linear form of x to use, I recommend setting up a range of x-values from -4 to 4, increasing in increments of 0.1 and then plotting y as different functions of x.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">^</span>{<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sin</span>(x)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span>x<span class="sc">^</span>{<span class="dv">2</span>}</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To model weight as a function of the square root of age and sex, we will first create a new variable consisting of the square root of age, and then refit the model with this as a covariate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>age.sq <span class="ot">&lt;-</span> dat<span class="sc">$</span>age<span class="sc">^</span>{<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> age.sq <span class="sc">+</span> sex, <span class="at">data=</span>dat)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age.sq + sex, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-714.49 -116.32  -12.64  107.33  874.01 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   25.148     12.934   1.944    0.052 .  
age.sq       331.173      5.638  58.741   &lt;2e-16 ***
sex          214.140      8.699  24.618   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 202.4 on 2282 degrees of freedom
  (43 observations deleted due to missingness)
Multiple R-squared:  0.6111,    Adjusted R-squared:  0.6108 
F-statistic:  1793 on 2 and 2282 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>betas2 <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(mod4)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>squage.range <span class="ot">&lt;-</span> age.range<span class="sc">^</span>{<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>}</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>des.mat.f <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, squage.range, <span class="dv">0</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>des.mat.m <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, squage.range, <span class="dv">1</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>new.pred.f <span class="ot">&lt;-</span> des.mat.f<span class="sc">%*%</span>betas2</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>new.pred.m <span class="ot">&lt;-</span> des.mat.m<span class="sc">%*%</span>betas2</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">"s"</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data =</span> dat, <span class="at">col=</span><span class="fu">factor</span>(dat<span class="sc">$</span>sex))</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(new.pred.f <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(new.pred.m <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is closer, but we still aren’t capturing that there is a rapid increase at the beginning followed by a tapering off and that the slopes are really different for male and female bison. We can model this with an <strong>interaction</strong> between our categorical predictor (sex) and our continuous predictor (the square root of age).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mod.int <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> age.sq <span class="sc">+</span> sex <span class="sc">+</span> age.sq<span class="sc">*</span>sex, <span class="at">data=</span>dat)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age.sq + sex + age.sq * sex, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-677.19  -81.18    2.93   83.82  508.67 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  228.973      9.268   24.71   &lt;2e-16 ***
age.sq       231.369      4.124   56.10   &lt;2e-16 ***
sex         -690.224     17.437  -39.59   &lt;2e-16 ***
age.sq:sex   513.445      9.353   54.89   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 132.9 on 2281 degrees of freedom
  (43 observations deleted due to missingness)
Multiple R-squared:  0.8325,    Adjusted R-squared:  0.8322 
F-statistic:  3778 on 3 and 2281 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>betas3 <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(mod.int)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>des.mat.f <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, squage.range, <span class="dv">0</span>, <span class="dv">0</span><span class="sc">*</span>squage.range)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>des.mat.m <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, squage.range, <span class="dv">1</span>, <span class="dv">1</span><span class="sc">*</span>squage.range)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>new.pred.f <span class="ot">&lt;-</span> des.mat.f<span class="sc">%*%</span>betas3</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>new.pred.m <span class="ot">&lt;-</span> des.mat.m<span class="sc">%*%</span>betas3</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">"s"</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data =</span> dat, <span class="at">col=</span><span class="fu">factor</span>(dat<span class="sc">$</span>sex))</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(new.pred.f <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(new.pred.m <span class="sc">~</span> age.range, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="evaluating-model-fit" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Evaluating model fit</h1>
<p><img src="https://i.pinimg.com/originals/62/75/bd/6275bd308a986cef65b7d85224ee43f8.png" class="img-fluid"></p>
<p>Just because we can fit a model, doesn’t necessarily mean it is a good model. How do we know if a model is a ‘good’ model? We could approach this in a whole lot of different ways.</p>
<section id="assumptions-of-linear-models-1" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="assumptions-of-linear-models-1"><span class="header-section-number">8.1</span> Assumptions of linear models</h2>
<p>First, does our model meet the assumptions of a linear model? If it doesn’t, it might not be a good model. But, how much are we willing to compromise on those assumptions to have any model at all? Remember that all models are going to be wrong and are imperfect representations of the world with a lot of simplifications, but the question is really whether or not we have cut too many corners. Earlier this semester, we played rectilinear pictionary where we were allowed to draw straight lines. What if instead we had played pointilism pictionary? How many guesses would it have taken people to figure out their animals if you were only allowed to draw one point per turn? Is that an assumption we would have been willing to accept was okay? What if, actually, one team had been allowed to draw curved lines while everyone else had to draw straight lines? Is that a rule we would have been okay with breaking? These sorts of questions, as ridiculous as they may seem, are the sort of things you want to consider when evaluating model fit. There is no right or wrong answer (okay, sometimes there are really, really bad models that would count as wrong answers…) but most of the time if you’re fitting a model, it will be somewhere in a grey zone of goodness.</p>
<section id="the-model-makes-biological-sense" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="the-model-makes-biological-sense"><span class="header-section-number">8.1.1</span> The model makes biological sense</h3>
<p>Remember that this is the single most important thing to keep in mind when fitting a model. If your model does not make biological sense, then you should not be fitting it, or quite frankly evaluating fit. It should still be in your mental checklist though, because it is very, very important to remind ourselves of this criterion! It can be tempting to consider a few different models, compare them by other metrics of ‘goodness’ and end up selecting a model that by and large is utter nonsense when you consider the biology or ecology of a system.</p>
<p>We used the sum of the squared residuals earlier when thinking about how to fit the best line through the data in an OLS sense. Let’s use that as a simplistic measure of ‘goodness’ for the two different models below. Remember that when using this as our metric, we want a smaller sum because that means the predicted and observed values are closer together. Let’s fit the model from above, with the square root of age and an interaction between sex and age, and a second model that also includes the day during the month we recorded them and an interaction term with sex. Is there any reason you can think of why, on later days in a 30-day calendar month, there should be some reason that individuals weigh more, and that this effect should be more pronounced (or less pronounced) for male than female bison? Do they perhaps get fed more at the beginning of the month because there was a new food shipment, and then later in the month males are more pushy so they continue to eat the dwindling food supply while females don’t get as much? Do they have monthly check-ins with a vet and are trying to watch their weight towards the end of the month? Is the grass mowed at the start of each calendar month so there is less food available and it is tied to a 12-month calendar? And for some reason this affects one sex more than the other? Most of these explanations seem pretty far-fetched, so even though the SSR is smaller for the model that includes this odd interaction term, it doesn’t really make biological sense, which means it is probably not as good of a model as our much more interpretable one. Sure, there could be better models than our original one that are also biologically interpretable, but the one I’ve proposed likely isn’t one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>calc_ssr <span class="ot">&lt;-</span> <span class="cf">function</span>(mod){</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">residuals</span>(mod)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>ssr1 <span class="ot">&lt;-</span> <span class="fu">calc_ssr</span>(<span class="fu">lm</span>(weight <span class="sc">~</span> age.sq<span class="sc">*</span>sex, <span class="at">data=</span>dat))</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>ssr2 <span class="ot">&lt;-</span> <span class="fu">calc_ssr</span>(<span class="fu">lm</span>(weight <span class="sc">~</span> age.sq<span class="sc">*</span>sex <span class="sc">+</span> RecDay<span class="sc">*</span>sex, <span class="at">data=</span>dat))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>ssr1 <span class="sc">-</span> ssr2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1056229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ssr1 <span class="sc">&gt;</span> ssr2 <span class="co"># so model two is better?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="the-effects-are-additive" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="the-effects-are-additive"><span class="header-section-number">8.1.2</span> The effects are additive</h3>
<p>Most of the time, the way you have conceptualized your model will mean you are meeting this assumption. A lot of the times in ecology when we have to deal with non-additive effects, we will have already done this through some sort of data transformation (e.g., things like exponentiation or logarithms) and still fit things in an additive manner. But, sometimes you really just need a model that just <em>fits</em> the data with a somewhat uninterpretable effect (i.e., nothing like a slope that we are used to seeing). For example, maybe you’ve got an effect that you think only kicks in at some point. We talked about drowning baby birds very early in the semester, and the potential for them to exhibit some either adaptive or plastic responses to sea level rise by having chicks climb to the top of nests to survive high tide. If, as has been hypothesized, they cannot actually climb until their bones are fully ossified, this effect may not kick in until say day six or seven. What we are dealing with in that case would be a step function or a hurdle model, where the predictor variable has to exceed some threshold before it has an effect. We could force this into a linear context, but it isn’t immediately clear how ‘additive’ it is (…but you can force most models to conform if you want to, hence however you conceptualize it is typically linear). Similarly, things like splines or local regression will fit different models to different portions of the data, so aren’t really additive in the broad sense but are within smaller areas, so we can kind of force most things to be additive. If you’re interested in this general question of modeling things without additive, linear effects, you should probably venture into GAM (Generalized Additive Model) world, which is something we won’t talk about in this course. Think of them sort of like just chucking all your data in a hat and seeing what comes out. As perhaps a more relatable example, ask any ‘AI’ model how it knows a picture of a cat is a cat, and it would probably tell you something like “it’s, y’know, kinda cat-like” and wave its hands a bit. A lot of ML models are sorta in this realm, and then people will fit post-hoc GAMs to be able to explain how the model eventually got to its conclusion. To be clear: GAMs are still additive, but they are kinda in the realm of “…yeah, but does my model really <em>have</em> to meet all those assumptions?”</p>
</section>
<section id="effects-are-linear" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="effects-are-linear"><span class="header-section-number">8.1.3</span> Effects are linear</h3>
<p>Same general comment as above: if you have conceptualized your model as having linear, additive effects, there is a pretty good chance you’re good to go with modeling your data as if it has linear, additive effects.</p>
</section>
<section id="errors-are-independent" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="errors-are-independent"><span class="header-section-number">8.1.4</span> Errors are independent</h3>
<p>When we talk about errors in this context, we are referring to the residuals of the model (not things like process or observational error). Remember that our ‘errors’ (or residuals) are the differences between the predicted and observed values. Let’s think about some reasons these errors might not be independent. Typically, in ecology this arises from either some sort of hierarchical grouping structure or an unmeasured covariate that would explain why we have ‘groups’ showing up in our errors. For example, what if for some reason we fit our bison model without including sex as a covariate?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>errors <span class="ot">&lt;-</span> <span class="fu">residuals</span>(<span class="fu">lm</span>(weight <span class="sc">~</span> age, <span class="at">data =</span> dat))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(errors, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data=</span>dat)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(weight <span class="sc">~</span> age, <span class="at">data=</span>dat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># looks like those big errors are maybe due to some grouping... </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We aren’t going to talk about non-independent errors right now, because we will spend a lot of time on these later in the semester when we get to mixed effects models and hierarchical models. For now, remember that you should think about potential covariate that might explain structure in your errors!</p>
</section>
<section id="errors-have-equal-variance-homoscedasticity" class="level3" data-number="8.1.5">
<h3 data-number="8.1.5" class="anchored" data-anchor-id="errors-have-equal-variance-homoscedasticity"><span class="header-section-number">8.1.5</span> Errors have equal variance (homoscedasticity)</h3>
<p>What we mean by homoscedasticity is that the spread in the errors is the same across all different values or levels of the predicted value. So if the errors were homoscedastic, they should basically just be a big blob with no trend line across the line of best fit. What would be especially bad here is a trend line, fan shape, or really anything you could draw a discernible shape around. Fish-shaped = bad. Pufferfish-shaped = probably good. If we see variance in the errors showing a pattern over predicted values, we are probably missing a covariate that might explain that trend, or there is something really bad about our overall fit. For example, if we have a fairly flat relationship between predicted values and errors at small values, but a large error at larger values, that might mean our model is just pretty bad at capturing the range of values in our data. If there is a strong trend, maybe we’ve got a missing covariate (or several!). What would indicate that this is probably not a big problem is just having a nice, fluff cloud of residuals with no clear patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(mod1) <span class="sc">~</span> <span class="fu">residuals</span>(mod1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="errors-are-normally-distributed" class="level3" data-number="8.1.6">
<h3 data-number="8.1.6" class="anchored" data-anchor-id="errors-are-normally-distributed"><span class="header-section-number">8.1.6</span> Errors are normally distributed</h3>
<p>While a straight-up linear model is not often done in ecology (our data typically don’t meet the assumptions - we will get to this soon in the course!), I would guess that this is most likely either the most, or second most, common issue with models. It is either this, or the assumption about independent errors, that are violated most often and lead us to other types of models. So, let’s take a look at our errors. We will go back to the most sensible model we have fit so far for this check. This plot doesn’t look too bad. We’ve got a lot of data, and we do expect our weight response variable to be normally distributed, which often (but not always!) means the errors are also often normally distributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod.int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(mod.int)) <span class="co"># residual quantiles </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(mod.int), <span class="at">col=</span><span class="st">"red"</span>) <span class="co"># theoretical quantiles for normal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="diagnostic-plots-in-r" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="diagnostic-plots-in-r"><span class="header-section-number">8.2</span> Diagnostic plots in R</h2>
<p>By default, R has some diagnostic plots for visually inspecting the goodness of our models to our data, mostly based on residuals and assumptions of linear models. To view them, you can call <code>plot()</code> on your model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">las=</span><span class="dv">1</span>) <span class="co"># 2 rows, 2 column layout</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod.int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>First is the residuals vs fitted plot. The residuals vs fitted plot helps us check if our errors vary with magnitude, i.e.&nbsp;do we have larger errors for larger predicted values? If we see a trend here, that means our model may only be good over some ranges of values. If this relationship is relatively flat, that means we should not be concerned about the model estimates being biased at certain range of our observed data.</p>
<p>Next is the Normal Q-Q plot. Remember that one of the assumptions of linear models is that the error are normally distributed. If the errors are normally distributed, they should fall along the line matching up with theoretical quantiles. This is just a visual check, so it is not really diagnostic, but can give us a good gut check on whether or nor the errors are normally distributed. There seems to be a fairly long tail in the lower end that deviates from the assumption, which we might have anticipated from our histogram of the response variable.</p>
<p>The third default diagnostic plot is Scale-Location, which helps us understand if our errors have equal variance (another assumption of linear models: homoscedasticity). Again, a relatively flat line here passes the gut check that model assumptions are met.</p>
<p>The final visual diagnostic check is residuals versus leverage. If data points have large leverage, you can interpret this as meaning that the estimates would change quite a bit if they were removed from the dataset before fitting the model. If particularly large, or particularly small, data points have high leverage, they would stand out in this plot and could indicate issues with the model fit or data.</p>
</section>
<section id="what-about-the-data" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="what-about-the-data"><span class="header-section-number">8.3</span> What about the data?</h2>
<p>Besides meeting the most basic assumptions of a linear model, we may also want to know if our model actually describes our data well. We can do this via model evaluation.</p>
<blockquote class="blockquote">
<p>An aside ramble: a lot of textbooks, papers, etc. will discuss model validation. As a quibble, there is really no such thing as model validation. Validation implies that we can test and validate a model, meaning we can confirm or prove it. The word ‘prove’ should set your hackles up, because never actually ‘prove’ anything in science. We just fail to disprove stuff. I’m personally still not sure the moon <em>isn’t</em> made of green cheese (unlikely, but… I haven’t disproven it; can’t prove it isn’t either). So, when you hear anyone talk about model ‘validaton’ you should pause for a second to think about what they actually mean!</p>
</blockquote>
<p>We will start with <span class="math inline">\(R^2\)</span>, which is a measure of how much your model matches the observed data. It is a measure of how much of the total variance in the response is described by the predictor variable(s). It is calculated as the sum of the squared residuals (sounds familiar!) divided by the total sum of squares. In equation form:</p>
<p><span class="math display">\[ SSR = \sum{(y_i - \hat{y_i})^2} \\ TSS = \sum(y_i - \bar{y_i})^2)\]</span> Let’s calculate <span class="math inline">\(R^2\)</span> for two of the models we fit earlier to see how much of the variance in the response they describe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ssr <span class="ot">&lt;-</span> <span class="cf">function</span>(mod){</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">sum</span>(<span class="fu">residuals</span>(mod)<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>tss <span class="ot">&lt;-</span> <span class="cf">function</span>(yi){</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((yi <span class="sc">-</span> <span class="fu">mean</span>(yi))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>calc_R2 <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, yi){</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">ssr</span>(mod)<span class="sc">/</span><span class="fu">tss</span>(yi)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_R2</span>(mod1, mod1<span class="sc">$</span>model<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4749924</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age + sex, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-835.03 -141.93  -19.71  125.43  961.16 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  404.216      9.585   42.17   &lt;2e-16 ***
age           58.855      1.328   44.32   &lt;2e-16 ***
sex          213.787     10.183   21.00   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 235.2 on 2282 degrees of freedom
  (43 observations deleted due to missingness)
Multiple R-squared:  0.475, Adjusted R-squared:  0.4745 
F-statistic:  1032 on 2 and 2282 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="overparameterizing" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="overparameterizing"><span class="header-section-number">8.4</span> Overparameterizing</h2>
<p>The more parameters we add to our model, the more we will be able to describe the data. Even if we just add random noise with a parameter value, we will still be able to describe our response variable better because the model has more to work with. If you take it to the extreme end, let’s imagine we have just as many covariates (or parameters) in our model as we do observations of our response variable. We could perfectly predict every data point because we would have the flexibility to use different parameter combinations for every data point and end up essentially drawing a line to connect all the dots. That’s why we aim to simplify our models so that we can actually make inference on them and explain our results, rather than just adding more and more parameters until we are essentially just building an airplane instead of a model of an airplane.</p>
<p>When we overparameterize a model, we also often overfit it, but those two concepts are not synonymous. A model that is overfit means that it is overly reliant on the data itself and really describes those data really well but is not generalizable. If you moved it to a new context, it would not perform well.</p>
</section>
<section id="within--and-out-of-sample-prediction" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="within--and-out-of-sample-prediction"><span class="header-section-number">8.5</span> Within- and out-of-sample prediction</h2>
<p>We can use within-sample (WS) and out-of-sample (OOS) prediction as one way of evaluating our model. An overfit model will perform really, really well on within sample data because it is fit to those data, but will perform poorly when confronted with new observations that it was not built with. This brings us to the idea of cross-validation (but remember, we don’t ever really ‘validate’ a model!) in which we set aside some parts of the data to build the model, and then test how well it performs on data that weren’t used to fit it. Let’s start simple and divide our data into training and evaluation datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(<span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(dat), <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fl">0.2</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>modA <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> age.sq <span class="sc">*</span> sex, <span class="at">data=</span>dat[train,])</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>dat.eval <span class="ot">&lt;-</span> dat[<span class="sc">!</span>train, <span class="fu">c</span>(<span class="st">'weight'</span>, <span class="st">'age.sq'</span>, <span class="st">'sex'</span>)]</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>desA <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, dat.eval[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], dat.eval[,<span class="dv">2</span>]<span class="sc">*</span>dat.eval[,<span class="dv">3</span>]))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>y.eval <span class="ot">&lt;-</span> dat.eval[,<span class="dv">1</span>]</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>y.pred <span class="ot">&lt;-</span> desA<span class="sc">%*%</span><span class="fu">coefficients</span>(modA)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y.eval <span class="sc">~</span> y.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>res.train <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modA)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>res.eval <span class="ot">&lt;-</span> <span class="fu">sum</span>((y.eval <span class="sc">-</span> y.pred)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could then look at a bunch of model evaluation metrics to see how well our model performs on the within versus out of sample data, and maybe consider alternative specifications that make it more generalizable. We can also extend this concept and rather than just doing one training and one evaluation dataset, we could split our data up into three, or five, or 10, or 100 different folds and repeat this process to get a sense of how the model performs on out of sample data. This is called k-fold cross-validation where <span class="math inline">\(k\)</span> is the number of folds. We aren’t going to go into this in any level of detail whatsoever in this course, but it is worth looking into if this is the sort of thing you may need for the types of models you use in your research.</p>
</section>
</section>
<section id="prediction-and-inference" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Prediction and inference</h1>
<section id="interpreting-coefficients" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="interpreting-coefficients"><span class="header-section-number">9.1</span> Interpreting coefficients</h2>
<p>The coefficient estimates that we get out of our model describe the relationships between the variables that we have included in our model. They are the answer to the question implied by our models when we fit them to test our hypotheses. If we think back to earlier in the semester and asking good questions with interesting questions, we might want to know something like “How does the weight of bison change across their lifespan, and how does it vary by sex?” rather than something like “Are male bison bigger than females?”. Our model answers the first question, and the coefficients are the answer.</p>
<p>Before we unpack these results for our best model (so far) with the interaction term, let’s go back to one of our earlier models that wasn’t very good, where we modeled weight as a function of age and sex separately, with no interaction term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>mod1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age + sex, data = dat)

Coefficients:
(Intercept)          age          sex  
     404.22        58.86       213.79  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the first coefficient is our intercept. this tells us the expected weight for</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a 0 year old, female bison</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(mod1)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   404.2158 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the second parameter for age tells us how much more, or less, a bison weighs</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for each additional year older it is</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(mod1)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     age 
58.85509 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the third coefficient for sex is the difference we need to add or subtract</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># if a bison is male (because we coded female = 0, male = 1)</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(mod1)[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     sex 
213.7865 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>mod.int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ age.sq + sex + age.sq * sex, data = dat)

Coefficients:
(Intercept)       age.sq          sex   age.sq:sex  
      229.0        231.4       -690.2        513.4  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the first coefficient is our intercept. this tells us the expected weight for</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a 0 year old, female bison</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the second parameter for age.sq tells us how much more, or less, a bison weighs</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for each additional increase of that covariate</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co"># if our covariate was just age, it would be for each additional year older it is</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="co"># because it is the square root of age, it is the increased weight for</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># each additional square root of years a bison ages</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co"># this is why it tapers off over time</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fu">coefficients</span>(mod.int)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age.sq 
231.3685 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">*</span><span class="fu">coefficients</span>(mod.int)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age.sq 
327.2045 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">3</span>)<span class="sc">*</span><span class="fu">coefficients</span>(mod.int)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> age.sq 
400.742 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">4</span>)<span class="sc">*</span><span class="fu">coefficients</span>(mod.int)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age.sq 
462.7371 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the third coefficient for sex is the difference we need to add or subtract</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># if a bison is male</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># our final coefficient in this model is the interaction of the square root of </span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># age and sex. it will behave similarly to the second coefficient, but only be </span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># applied if a bison is male. this means we have an additional effect</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># of the square root of age that only applies for male bison, allowing them</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to grow really, really fast early on and then taper off</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predicting" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="predicting"><span class="header-section-number">9.2</span> Predicting</h2>
<p>Instead of creating a design matrix and multiplying it by our vector of coefficient estimates, there is a built-in function in R to make predictions from a model called <code>predict</code>. If we run predict on our model without any other arguments, it will return the expected value for every observation in our dataset that we used to fit the model. We can also pass new data to the predict function to predict across a range of responses, which is typically what we are actually interested in doing because we want to make inference about the general relationship, not specific individuals. We can also use it to extrapolate beyond the range of values used to fit the model (but shouldn’t!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># expected value for each observation in our dataset</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     2421      2422      2423      3932      3933      3934      2424      3935 
1314.1873 1289.2365 1289.2365 1289.2365 1289.2365 1289.2365 1263.6842 1263.6842 
     2425      3135      3137      6120      6121      6482      7573      1415 
1237.4848 1237.4848 1237.4848 1237.4848 1237.4848 1237.4848 1237.4848 1210.5862 
     2426      2427      2428      2429      3140      3532      3533      3936 
1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 
     5066      5732      6483      6833      7957      7958      1418      2790 
1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 1210.5862 1182.9296 1182.9296 
     3142      3534      5067      5733      6484      7204      7205      7206 
1182.9296 1182.9296 1182.9296 1182.9296 1182.9296 1182.9296 1182.9296 1182.9296 
     7207      7208      7575      7959      7960      2057      2793      3146 
1182.9296 1182.9296 1182.9296 1182.9296 1182.9296 1154.4468 1154.4468 1154.4468 
     3147      3148      3149      3937      4720      5068      5379      5381 
1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 
     5735      5736      6124      6125      6127      6486      6835      6837 
1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 
     7212      7213      7579      7961      7962      7963       149       901 
1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1154.4468 1125.0592 1125.0592 
     1147      1421      1425      3150      3938      3939      4339      4723 
1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 
     5383      5385      5386      5387      5388      6130      6131      6490 
1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 
     6493      6843      7215      7582      7583      7584      7964      7965 
1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 1125.0592 
     7966      7967      7968      7969       286       625      1727      1728 
1125.0592 1125.0592 1125.0592 1125.0592 1094.6745 1094.6745 1094.6745 1094.6745 
     2065      5080      5391      5393      6499      6500      6504      6852 
1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 
     7223      7589      7593      7970      7971      7972      7973      1434 
1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1094.6745 1063.1838 
     1436      1437      2069      3153      3542      3944      4342      4736 
1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 
     5086      5394      5397      5399      5400      5403      5754      7230 
1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 
     7974      7975      7976      7977      7978      7979      7980       487 
1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1063.1838 1030.4568 
     1167      1168      3948      4350      4351      4741      5759      6513 
1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 
     6865      7237      7599      7981      7982      7983      7984      7985 
1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 1030.4568 
     7986      7987      7988      7989      7990       490       492       918 
1030.4568 1030.4568 1030.4568 1030.4568 1030.4568  996.3353  996.3353  996.3353 
      929      1447      2075      3163      3164      3546      4364      4367 
 996.3353 2009.0155  996.3353  996.3353  996.3353  996.3353  996.3353  996.3353 
     5098      5409      5411      5767      5771      6163      6528      7615 
 996.3353  996.3353  996.3353  996.3353  996.3353  996.3353  996.3353  996.3353 
     7991      7992      7993      7994      7995      7996      7997      7998 
 996.3353  996.3353  996.3353  996.3353  996.3353  996.3353  996.3353  996.3353 
      159       298       299       498      1454      3166      3174      4370 
 960.6242 1894.0556 1894.0556  960.6242 1894.0556  960.6242 1894.0556  960.6242 
     5426      5429      5779      6530      6534      7625      7999      8000 
 960.6242  960.6242  960.6242  960.6242  960.6242  960.6242  960.6242  960.6242 
     8001      8002      8003      8004      8005      8006      8007      8008 
 960.6242  960.6242  960.6242  960.6242  960.6242  960.6242  960.6242  960.6242 
     8009      8010      8011       162       306       307       653       654 
 960.6242  960.6242  960.6242  923.0783  923.0783 1773.1890 1773.1890  923.0783 
      655       656       661      1456      2458      2460      3181      3187 
1773.1890  923.0783  923.0783 1773.1890 1773.1890 1773.1890 1773.1890  923.0783 
     3568      3978      3981      4380      4381      5432      5433      5440 
 923.0783  923.0783  923.0783  923.0783  923.0783  923.0783  923.0783 1773.1890 
     5442      6178      6542      6883      6884      6893      7263      7637 
 923.0783  923.0783 1773.1890  923.0783 1773.1890 1773.1890  923.0783 1773.1890 
     8012      8013      8014      8015      8016      8017      8018      8019 
 923.0783  923.0783  923.0783  923.0783  923.0783  923.0783  923.0783  923.0783 
     8020      8021      8022      8023       171       315       519       663 
 923.0783  923.0783  923.0783  923.0783 1645.3992  883.3817  883.3817  883.3817 
      944       945       946      1751      2092      2466      2467      2469 
 883.3817  883.3817  883.3817  883.3817  883.3817 1645.3992 1645.3992 1645.3992 
     2475      2476      2828      2833      3189      3193      3198      3199 
1645.3992  883.3817  883.3817 1645.3992 1645.3992  883.3817 1645.3992 1645.3992 
     3575      3583      3585      3586      3587      3591      3987      3991 
1645.3992 1645.3992 1645.3992 1645.3992  883.3817 1645.3992 1645.3992 1645.3992 
     3992      3995      3998      3999      4388      4390      4772      4778 
1645.3992 1645.3992 1645.3992 1645.3992  883.3817  883.3817 1645.3992 1645.3992 
     4780      4781      4782      4788      4790      5128      5132      5134 
 883.3817 1645.3992 1645.3992  883.3817 1645.3992 1645.3992 1645.3992 1645.3992 
     5136      5444      5445      5446      5451      5452      5453      5456 
1645.3992  883.3817  883.3817 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 
     5458      5799      5803      5804      5806      5807      5808      6184 
 883.3817 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 
     6186      6191      6192      6194      6555      6556      6558      6897 
1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 1645.3992 
     6898      6902      6903      6905      6906      7272      7274      7277 
1645.3992 1645.3992 1645.3992 1645.3992  883.3817 1645.3992  883.3817 1645.3992 
     7282      7284      7642      7648      7650      7651      7655      8024 
1645.3992 1645.3992 1645.3992  883.3817 1645.3992 1645.3992 1645.3992  883.3817 
     8025      8026      8027      8028      8029      8030      8031      8032 
 883.3817  883.3817 1645.3992  883.3817  883.3817 1645.3992  883.3817 1645.3992 
     8033      8034      8035      8036      8037       179       181       183 
1645.3992  883.3817 1645.3992  883.3817  883.3817 1509.3398 1509.3398 1509.3398 
      328       329       672       948       951       952      1464      1469 
1509.3398  841.1163 1509.3398  841.1163  841.1163  841.1163 1509.3398 1509.3398 
     1754      1759      2483      2843      2848      2854      2855      2856 
 841.1163  841.1163  841.1163  841.1163 1509.3398 1509.3398 1509.3398 1509.3398 
     2857      2858      3207      3215      3216      3597      4003      4007 
1509.3398 1509.3398  841.1163 1509.3398  841.1163 1509.3398 1509.3398 1509.3398 
     4011      4400      4402      4405      4421      4794      5467      5468 
1509.3398 1509.3398 1509.3398 1509.3398  841.1163  841.1163 1509.3398 1509.3398 
     5470      5471      5473      5475      5477      5479      5813      5820 
1509.3398 1509.3398 1509.3398 1509.3398  841.1163 1509.3398  841.1163  841.1163 
     6211      6214      6569      6574      6920      6932      7291      7662 
1509.3398 1509.3398  841.1163 1509.3398 1509.3398  841.1163  841.1163  841.1163 
     8038      8039      8040      8041      8042      8043      8044      8045 
 841.1163  841.1163  841.1163  841.1163  841.1163  841.1163  841.1163  841.1163 
     8046      8047      8048      8049      8050      8051      8052      8053 
 841.1163 1509.3398 1509.3398  841.1163  841.1163 1509.3398 1509.3398  841.1163 
     8054      8055        20       193       194       195       197       198 
 841.1163 1509.3398  795.7076 1363.1615 1363.1615 1363.1615 1363.1615 1363.1615 
      199       339       678       679       683       958       959      1470 
1363.1615 1363.1615 1363.1615  795.7076  795.7076  795.7076  795.7076  795.7076 
     1471      1771      2109      2118      3223      3230      4436      4438 
1363.1615  795.7076  795.7076  795.7076  795.7076  795.7076 1363.1615  795.7076 
     4824      5154      5158      5481      5482      5489      5492      5829 
 795.7076 1363.1615  795.7076 1363.1615  795.7076  795.7076  795.7076  795.7076 
     5835      6218      6232      6233      6237      6947      7306      7317 
1363.1615 1363.1615 1363.1615  795.7076 1363.1615 1363.1615  795.7076  795.7076 
     7319      7684      7687      8056      8057      8058      8059      8060 
 795.7076  795.7076  795.7076  795.7076 1363.1615  795.7076 1363.1615  795.7076 
     8061      8062      8063      8064      8065      8066      8067      8068 
 795.7076  795.7076  795.7076  795.7076  795.7076 1363.1615 1363.1615  795.7076 
     8069      8070      8071       206       207       208       209       347 
 795.7076 1363.1615  795.7076 1204.2021  746.3285  746.3285  746.3285 1204.2021 
      348       349       687       690       692       693       695       960 
1204.2021 1204.2021 1204.2021 1204.2021  746.3285  746.3285  746.3285  746.3285 
      963       964       969      1202      1782      1788      2137      3247 
 746.3285  746.3285  746.3285 1204.2021  746.3285  746.3285  746.3285 1204.2021 
     3253      3254      3625      4442      4452      4458      4463      4825 
1204.2021  746.3285  746.3285  746.3285  746.3285 1204.2021  746.3285  746.3285 
     4843      4848      5182      5184      5503      5507      5856      5867 
 746.3285 1204.2021  746.3285  746.3285  746.3285  746.3285  746.3285  746.3285 
     6239      6245      6255      6260      6601      6610      6616      6966 
1204.2021  746.3285  746.3285  746.3285 1204.2021  746.3285 1204.2021  746.3285 
     7695      7699      7709      7710      8072      8073      8074      8075 
1204.2021  746.3285 1204.2021  746.3285 1204.2021  746.3285  746.3285  746.3285 
     8076      8077      8078      8079      8080      8081      8082      8083 
 746.3285  746.3285 1204.2021  746.3285 1204.2021  746.3285  746.3285  746.3285 
     8084      8085      8086      8087      8088      8089      8090      8091 
1204.2021  746.3285 1204.2021  746.3285  746.3285  746.3285  746.3285  746.3285 
     8092      8093        34        35        36        37        38        39 
 746.3285 1204.2021 1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 
       40        41        42        43        44       216       219       220 
1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 1028.3755 
      698       699       702       703       704       705       707       711 
 691.7098  691.7098 1028.3755 1028.3755  691.7098  691.7098  691.7098  691.7098 
      712       713       718       973      1500      1796      1799      1810 
 691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098 
     1817      2156      2161      3277      3647      3659      3664      4465 
 691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098 
     4483      4485      4489      4856      5517      5526      5531      6273 
1028.3755  691.7098  691.7098  691.7098  691.7098 1028.3755  691.7098  691.7098 
     6274      6283      6626      8094      8095      8096      8097      8098 
1028.3755 1028.3755 1028.3755  691.7098  691.7098 1028.3755 1028.3755 1028.3755 
     8099      8100      8101      8102      8103      8104      8105      8106 
 691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098  691.7098 
     8107      8108      8109      8110      8111      8112      8113      8114 
 691.7098  691.7098  691.7098 1028.3755 1028.3755  691.7098  691.7098 1028.3755 
       48        54        55        56        57        58        61        62 
 828.8033  828.8033  828.8033  629.7148  629.7148  629.7148  629.7148  629.7148 
       63        64        65        66        67        68        69        70 
 629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  629.7148  629.7148 
       71       222       223       224       225       226       361       362 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033  828.8033 
      363       364       366       367       368       369       370       371 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
      372       373       374       379       381       382       383       384 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
      386       387       388       545       721       722       723       725 
 828.8033  828.8033  629.7148  629.7148  828.8033  828.8033  828.8033  828.8033 
      726       728       729       730       731       732       734       737 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  629.7148  629.7148 
      738       739       740       741       742       743       744       745 
 629.7148  828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033 
      747       748       750       751       752       756       757       760 
 828.8033  629.7148  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
      761       762       763       765       986       997       998      1227 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     1228      1229      1230      1231      1232      1233      1234      1236 
 629.7148  629.7148  629.7148  828.8033  828.8033  629.7148  828.8033  629.7148 
     1237      1238      1239      1240      1241      1243      1244      1246 
 629.7148  629.7148  828.8033  629.7148  828.8033  828.8033  629.7148  828.8033 
     1247      1249      1250      1253      1255      1256      1257      1258 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  629.7148  828.8033 
     1259      1260      1261      1262      1263      1266      1267      1268 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  629.7148  828.8033 
     1271      1519      1520      1521      1523      1524      1525      1526 
 629.7148  828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033 
     1528      1529      1531      1532      1533      1534      1537      1538 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     1540      1541      1544      1546      1547      1548      1549      1823 
 629.7148  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     1824      1825      1827      1828      1829      1830      1831      1832 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033  828.8033 
     1833      1834      1836      1838      1841      1842      1843      1844 
 629.7148  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     1847      1848      1849      1851      1854      1857      1859      1860 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148  828.8033 
     1861      1862      1863      1868      2171      2173      2175      2176 
 828.8033  828.8033  828.8033  629.7148  629.7148  828.8033  828.8033  629.7148 
     2177      2178      2183      2184      2185      2187      2189      2190 
 828.8033  828.8033  828.8033  828.8033  629.7148  828.8033  828.8033  828.8033 
     2191      2194      2195      2196      2197      2198      2199      2200 
 828.8033  629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  828.8033 
     2201      2202      2203      2205      2208      2209      2210      2553 
 828.8033  629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  828.8033 
     2554      2555      2556      2557      2558      2559      2563      2564 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     2565      2566      2567      2568      2569      2572      2573      2574 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2576      2581      2583      2584      2585      2586      2587      2588 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     2589      2590      2593      2594      2595      2599      2600      2601 
 828.8033  629.7148  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2604      2605      2607      2608      2609      2610      2919      2920 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2921      2922      2926      2929      2931      2932      2935      2936 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2940      2942      2943      2947      2948      2949      2950      2951 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2952      2953      2954      2955      2957      2961      2962      2964 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148  828.8033 
     2965      2966      2967      2968      2969      2971      2972      2973 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     2974      2975      2976      2978      2979      2980      2982      2984 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     3284      3288      3289      3290      3294      3295      3296      3297 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     3299      3303      3309      3310      3311      3314      3316      3317 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148  828.8033 
     3318      3319      3321      3322      3324      3668      3669      3670 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     3671      3672      3674      3675      3677      3678      3683      3686 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     3687      3688      3690      3691      3694      3695      3699      3700 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033 
     3701      3704      4082      4083      4084      4087      4088      4089 
 828.8033  828.8033  629.7148  828.8033  828.8033  629.7148  828.8033  828.8033 
     4090      4092      4093      4094      4095      4096      4099      4100 
 629.7148  828.8033  828.8033  828.8033  629.7148  828.8033  828.8033  828.8033 
     4101      4102      4105      4106      4109      4113      4115      4120 
 629.7148  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     4121      4122      4124      4125      4128      4130      4132      4133 
 828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  828.8033  629.7148 
     4137      4138      4140      4141      4493      4494      4495      4496 
 828.8033  828.8033  828.8033  828.8033  629.7148  828.8033  629.7148  629.7148 
     4497      4498      4499      4500      4501      4503      4504      4505 
 828.8033  828.8033  629.7148  629.7148  828.8033  629.7148  629.7148  629.7148 
     4507      4508      4509      4510      4511      4512      4513      4514 
 828.8033  828.8033  629.7148  828.8033  828.8033  629.7148  629.7148  828.8033 
     4515      4519      4520      4522      4523      4524      4525      4529 
 629.7148  828.8033  828.8033  629.7148  828.8033  629.7148  629.7148  828.8033 
     4530      4531      4532      4533      4534      4535      4537      4538 
 629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  629.7148  828.8033 
     4543      4545      4546      4548      4550      4551      4552      4553 
 629.7148  828.8033  828.8033  828.8033  828.8033  629.7148  629.7148  828.8033 
     4554      4556      4557      4558      4871      4873      4874      4875 
 629.7148  828.8033  828.8033  828.8033  629.7148  828.8033  629.7148  629.7148 
     4877      4878      4879      4880      4881      4887      4888      4890 
 828.8033  828.8033  828.8033  828.8033  629.7148  629.7148  629.7148  828.8033 
     4891      4892      4894      4897      4898      4899      4901      4902 
 828.8033  828.8033  629.7148  629.7148  629.7148  828.8033  828.8033  828.8033 
     4906      4908      4909      4911      4912      5209      5213      5214 
 629.7148  629.7148  828.8033  629.7148  828.8033  629.7148  629.7148  828.8033 
     5215      5218      5219      5220      5221      5222      5223      5229 
 629.7148  828.8033  629.7148  629.7148  828.8033  828.8033  629.7148  629.7148 
     5231      5235      5236      5238      5239      5240      5242      5243 
 828.8033  828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033 
     5244      5540      5541      5542      5543      5545      5546      5547 
 828.8033  828.8033  828.8033  629.7148  828.8033  828.8033  629.7148  629.7148 
     5548      5552      5554      5555      5556      5557      5559      5561 
 828.8033  828.8033  828.8033  629.7148  629.7148  629.7148  828.8033  828.8033 
     5562      5563      5564      5571      5574      5575      5576      5577 
 828.8033  828.8033  828.8033  629.7148  828.8033  629.7148  629.7148  828.8033 
     5579      5585      5586      5896      5901      5902      5903      5904 
 828.8033  629.7148  828.8033  629.7148  828.8033  828.8033  828.8033  629.7148 
     5905      5906      5907      5909      5912      5914      5917      5918 
 828.8033  828.8033  828.8033  629.7148  629.7148  629.7148  828.8033  629.7148 
     5923      5924      5925      5929      5931      5932      5938      5939 
 828.8033  828.8033  629.7148  828.8033  828.8033  828.8033  828.8033  629.7148 
     6291      6292      6295      6297      6298      6299      6300      6302 
 828.8033  828.8033  828.8033  828.8033  629.7148  828.8033  629.7148  629.7148 
     6303      6306      6307      6308      6309      6310      6311      6312 
 629.7148  828.8033  828.8033  828.8033  629.7148  828.8033  629.7148  828.8033 
     6313      6314      6316      6317      6318      6320      6321      6324 
 828.8033  629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  629.7148 
     6325      6327      6328      6330      6332      6333      6334      6336 
 629.7148  629.7148  828.8033  828.8033  629.7148  629.7148  828.8033  629.7148 
     6644      6645      6648      6654      6657      6659      6665      6666 
 629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148 
     6667      6670      6671      6994      6996      6997      6999      7003 
 629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  828.8033 
     7006      7013      7019      7362      7363      7364      7368      7373 
 629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148 
     7376      7377      7385      7391      7392      7734      7737      7742 
 629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148 
     7748      7749      7751      7753      7756      7758      8115      8116 
 629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  828.8033  629.7148 
     8117      8118      8119      8120      8121      8122      8123      8124 
 629.7148  828.8033  629.7148  629.7148  629.7148  629.7148  629.7148  828.8033 
     8125      8126      8127      8128      8129      8130      8131      8132 
 828.8033  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148 
     8133      8134      8135      8136      8137      8138      8139      8140 
 629.7148  828.8033  629.7148  629.7148  629.7148  629.7148  629.7148  629.7148 
     8141        73        74        75        76        77        79        80 
 828.8033  556.1772  556.1772  592.0738  592.0738  556.1772  592.0738  556.1772 
       81        82        84        85        86        87        88        89 
 592.0738  592.0738  556.1772  556.1772  592.0738  592.0738  556.1772  592.0738 
       90        91        92        94        96        97        98        99 
 592.0738  556.1772  556.1772  556.1772  592.0738  592.0738  556.1772  556.1772 
      100       101       102       247       390       391       392       393 
 556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  592.0738 
      395       397       398       399       402       403       405       407 
 592.0738  592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738 
      410       414       416       420       424       428       429       561 
 556.1772  592.0738  592.0738  592.0738  592.0738  556.1772  556.1772  592.0738 
      766       768       769       771       772       774       775       777 
 556.1772  592.0738  556.1772  592.0738  556.1772  556.1772  592.0738  556.1772 
      779       780       781       782       783       784       785       786 
 592.0738  556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  556.1772 
      787       788       789       791       793       796       797       799 
 556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  556.1772  556.1772 
      801       802       803       804       805       806       807       808 
 592.0738  556.1772  556.1772  592.0738  556.1772  556.1772  556.1772  556.1772 
      810       811       812       813       814       815      1005      1009 
 592.0738  556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738 
     1023      1038      1052      1055      1273      1274      1279      1280 
 592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738  592.0738 
     1283      1285      1290      1296      1301      1302      1307      1309 
 556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  592.0738 
     1310      1315      1318      1319      1562      1564      1566      1569 
 592.0738  556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  556.1772 
     1575      1576      1582      1588      1589      1594      1599      1605 
 556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772 
     1609      1612      1871      1875      1876      1877      1881      1882 
 592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  592.0738  556.1772 
     1883      1889      1890      1891      1892      1901      1902      1905 
 592.0738  556.1772  556.1772  592.0738  556.1772  556.1772  556.1772  592.0738 
     1906      1909      1910      1912      1913      1927      1929      2214 
 556.1772  556.1772  592.0738  556.1772  592.0738  556.1772  556.1772  556.1772 
     2218      2220      2221      2222      2228      2232      2234      2236 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  592.0738 
     2239      2245      2247      2250      2273      2280      2283      2284 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     2285      2287      2290      2291      2292      2616      2617      2618 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     2621      2622      2631      2637      2638      2640      2647      2651 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     2652      2653      2657      2661      2663      2666      2668      2671 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     2672      2673      2695      2696      2699      2989      2999      3013 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     3020      3025      3027      3030      3035      3036      3327      3328 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  592.0738 
     3329      3333      3334      3335      3337      3338      3342      3343 
 592.0738  592.0738  592.0738  556.1772  556.1772  592.0738  556.1772  556.1772 
     3344      3351      3358      3359      3360      3361      3363      3365 
 556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  592.0738 
     3369      3370      3373      3374      3375      3376      3377      3378 
 592.0738  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  556.1772 
     3379      3380      3382      3394      3395      3398      3402      3706 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  592.0738  592.0738 
     3711      3713      3715      3716      3723      3724      3728      3729 
 556.1772  556.1772  556.1772  556.1772  592.0738  556.1772  592.0738  592.0738 
     3732      3734      3735      3736      3737      3743      3744      3746 
 556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772  592.0738 
     3748      3750      3754      3758      3760      3761      3762      3764 
 556.1772  556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738 
     3765      3768      3769      3770      3771      3775      3776      3778 
 592.0738  592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738 
     3779      3781      3783      3784      3792      3794      3795      3796 
 592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  556.1772  592.0738 
     3799      3800      3802      3804      3809      3810      3812      4142 
 556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772 
     4147      4153      4155      4165      4172      4173      4174      4178 
 592.0738  556.1772  556.1772  556.1772  556.1772  556.1772  592.0738  592.0738 
     4179      4181      4184      4185      4188      4189      4191      4194 
 556.1772  592.0738  592.0738  592.0738  556.1772  556.1772  556.1772  556.1772 
     4195      4197      4201      4203      4206      4208      4210      4211 
 556.1772  592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738 
     4216      4218      4220      4223      4225      4226      4227      4229 
 556.1772  556.1772  556.1772  592.0738  556.1772  592.0738  556.1772  592.0738 
     4234      4235      4236      4239      4240      4244      4248      4251 
 556.1772  592.0738  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772 
     4559      4561      4563      4564      4567      4568      4570      4571 
 556.1772  592.0738  556.1772  592.0738  592.0738  556.1772  556.1772  556.1772 
     4574      4575      4580      4581      4582      4583      4588      4589 
 592.0738  556.1772  592.0738  592.0738  592.0738  592.0738  592.0738  556.1772 
     4590      4594      4595      4597      4599      4609      4611      4612 
 556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772  556.1772 
     4616      4619      4622      4623      4624      4627      4628      4629 
 592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  592.0738  592.0738 
     4634      4635      4918      4919      4920      4923      4925      4935 
 556.1772  592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738 
     4936      4937      4940      4941      4944      4945      4948      4954 
 592.0738  556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738 
     4955      4956      4958      4959      4965      4967      4968      4969 
 556.1772  556.1772  592.0738  592.0738  592.0738  556.1772  556.1772  556.1772 
     4971      4975      4976      4977      4978      4981      4982      4985 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738  556.1772 
     5249      5251      5252      5254      5255      5258      5259      5262 
 556.1772  556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  592.0738 
     5268      5271      5273      5274      5283      5285      5287      5292 
 592.0738  556.1772  556.1772  592.0738  556.1772  556.1772  556.1772  556.1772 
     5293      5299      5302      5303      5304      5306      5307      5312 
 556.1772  556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738 
     5589      5590      5591      5592      5593      5596      5599      5600 
 556.1772  556.1772  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738 
     5602      5604      5605      5606      5608      5610      5612      5617 
 556.1772  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  556.1772 
     5618      5620      5621      5622      5623      5626      5627      5629 
 556.1772  592.0738  592.0738  592.0738  556.1772  556.1772  556.1772  556.1772 
     5630      5631      5633      5634      5635      5636      5638      5640 
 556.1772  592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  556.1772 
     5641      5642      5643      5644      5646      5649      5651      5942 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  556.1772 
     5943      5944      5947      5949      5950      5951      5954      5955 
 556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772 
     5956      5957      5958      5963      5964      5965      5966      5967 
 556.1772  592.0738  556.1772  556.1772  592.0738  556.1772  592.0738  592.0738 
     5968      5977      5979      5980      5982      5983      5984      5989 
 592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  592.0738  556.1772 
     5991      6000      6001      6002      6003      6004      6007      6008 
 592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  592.0738  592.0738 
     6011      6012      6014      6017      6018      6025      6028      6029 
 592.0738  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  556.1772 
     6030      6031      6032      6034      6037      6038      6039      6040 
 592.0738  592.0738  556.1772  592.0738  556.1772  556.1772  592.0738  592.0738 
     6041      6042      6043      6044      6341      6342      6344      6349 
 592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  592.0738  592.0738 
     6350      6351      6353      6357      6358      6359      6360      6361 
 592.0738  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  556.1772 
     6362      6365      6367      6368      6370      6371      6375      6376 
 556.1772  592.0738  592.0738  592.0738  592.0738  592.0738  592.0738  592.0738 
     6377      6379      6382      6384      6386      6388      6389      6392 
 556.1772  592.0738  592.0738  592.0738  556.1772  592.0738  556.1772  592.0738 
     6394      6395      6396      6397      6398      6400      6401      6402 
 592.0738  556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  592.0738 
     6404      6407      6409      6411      6412      6413      6414      6675 
 556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  556.1772  556.1772 
     6677      6680      6681      6682      6683      6684      6685      6689 
 592.0738  592.0738  592.0738  556.1772  592.0738  556.1772  592.0738  556.1772 
     6690      6691      6692      6693      6694      6696      6697      6699 
 592.0738  556.1772  556.1772  556.1772  592.0738  592.0738  556.1772  592.0738 
     6702      6704      6705      6707      6712      6715      6716      6717 
 556.1772  556.1772  592.0738  592.0738  556.1772  592.0738  556.1772  592.0738 
     6720      6722      6724      6725      6726      6728      6730      6734 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738  592.0738 
     6735      6736      7020      7022      7023      7025      7027      7028 
 556.1772  592.0738  592.0738  592.0738  556.1772  556.1772  592.0738  592.0738 
     7030      7031      7032      7033      7034      7037      7039      7040 
 592.0738  556.1772  556.1772  592.0738  556.1772  592.0738  556.1772  592.0738 
     7042      7043      7044      7046      7047      7048      7049      7050 
 556.1772  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738  556.1772 
     7051      7052      7053      7060      7061      7062      7063      7064 
 592.0738  592.0738  592.0738  592.0738  592.0738  592.0738  592.0738  592.0738 
     7066      7068      7069      7070      7071      7073      7074      7075 
 592.0738  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  592.0738 
     7076      7078      7079      7081      7082      7083      7085      7086 
 556.1772  556.1772  592.0738  592.0738  592.0738  556.1772  556.1772  592.0738 
     7088      7091      7092      7093      7094      7096      7097      7099 
 592.0738  592.0738  556.1772  592.0738  556.1772  556.1772  556.1772  592.0738 
     7104      7105      7106      7108      7110      7111      7112      7393 
 592.0738  592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  592.0738 
     7394      7395      7398      7400      7401      7404      7406      7407 
 556.1772  556.1772  556.1772  592.0738  592.0738  556.1772  592.0738  592.0738 
     7408      7409      7410      7411      7412      7413      7414      7416 
 592.0738  592.0738  592.0738  592.0738  556.1772  556.1772  556.1772  592.0738 
     7417      7418      7419      7420      7421      7422      7423      7424 
 592.0738  556.1772  592.0738  592.0738  592.0738  556.1772  592.0738  592.0738 
     7425      7426      7429      7430      7431      7433      7434      7436 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  592.0738 
     7437      7439      7443      7444      7445      7446      7447      7448 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738  592.0738 
     7450      7451      7453      7454      7455      7458      7459      7460 
 592.0738  556.1772  556.1772  592.0738  592.0738  592.0738  592.0738  592.0738 
     7463      7464      7465      7466      7469      7472      7475      7477 
 592.0738  556.1772  592.0738  556.1772  556.1772  556.1772  556.1772  592.0738 
     7478      7480      7482      7764      7765      7766      7769      7770 
 592.0738  592.0738  592.0738  592.0738  556.1772  556.1772  592.0738  556.1772 
     7771      7772      7773      7774      7776      7777      7778      7780 
 556.1772  592.0738  592.0738  556.1772  556.1772  592.0738  592.0738  592.0738 
     7781      7782      7783      7784      7786      7787      7788      7791 
 592.0738  592.0738  592.0738  556.1772  592.0738  592.0738  556.1772  592.0738 
     7792      7793      7794      7795      7796      7797      7798      7799 
 556.1772  592.0738  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772 
     7800      7801      7802      7804      7805      7809      7810      7811 
 592.0738  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  592.0738 
     7812      7813      7815      7818      7819      7820      7823      7824 
 556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  556.1772  592.0738 
     7825      7826      7827      7829      7830      7834      7835      7836 
 556.1772  592.0738  592.0738  556.1772  592.0738  592.0738  592.0738  556.1772 
     7837      7839      7842      7844      7845      7847      7850      7851 
 592.0738  592.0738  592.0738  592.0738  592.0738  556.1772  556.1772  556.1772 
     7852      8142      8143      8144      8145      8146      8147      8148 
 592.0738  556.1772  556.1772  556.1772  592.0738  556.1772  592.0738  592.0738 
     8149      8150      8151      8152      8153      8154      8155      8156 
 556.1772  592.0738  556.1772  556.1772  592.0738  556.1772  592.0738  556.1772 
     8157      8158      8159      8160      8161      8162      8163      8164 
 556.1772  556.1772  592.0738  592.0738  592.0738  556.1772  592.0738  556.1772 
     8165      8166      8167      8168      8169      8170      8171      8172 
 592.0738  556.1772  592.0738  592.0738  556.1772  556.1772  592.0738  556.1772 
     8173      8174      8175      8176      8177      8178      8179      8180 
 556.1772  592.0738  556.1772  556.1772  592.0738  592.0738  592.0738  592.0738 
     8181      8182      8183      8184      8185      8186      8187      8188 
 556.1772  556.1772  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772 
     8189      8190      8191      8192      8193      8194      8195      8196 
 592.0738  556.1772  592.0738  592.0738  556.1772  556.1772  592.0738  592.0738 
     8197      8198      8199      8200      8201      8202      8203      8204 
 592.0738  592.0738  592.0738  556.1772  556.1772  556.1772  592.0738  556.1772 
     8205      8206      8207      8208      8209      8210      8211      8212 
 556.1772  592.0738  556.1772  592.0738  556.1772  592.0738  592.0738  556.1772 
     8213      8214      8215      8216      8217      8218      8219      8220 
 592.0738  556.1772  556.1772  556.1772  556.1772  556.1772  592.0738  556.1772 
     8221      8222      8223      8224      8225      8226      8227      8228 
 592.0738  556.1772  556.1772  592.0738  592.0738  592.0738  556.1772  592.0738 
     8229      8230      8231      8232      8233      8234      8235      8237 
 556.1772  592.0738  556.1772  592.0738  592.0738  556.1772  556.1772  556.1772 
     8238      8239      8240      8241      8242       105       110       113 
 592.0738  556.1772  556.1772  556.1772  592.0738  283.5620  460.3413  460.3413 
      114       115       117       118       122       123       124       127 
 283.5620  460.3413  460.3413  460.3413  460.3413  460.3413  283.5620  460.3413 
      128       131       137       143       258       431       432       433 
 460.3413  460.3413  283.5620  283.5620  283.5620  460.3413  460.3413  460.3413 
      439       441       444       446       448       449       451       452 
 460.3413  460.3413  460.3413  460.3413  460.3413  283.5620  460.3413  460.3413 
      453       471       473       827       828       829       833       844 
 460.3413  283.5620  460.3413  283.5620  283.5620  460.3413  460.3413  460.3413 
      863       866       872       875       880       881      1081      1349 
 283.5620  283.5620  283.5620  283.5620  283.5620  460.3413  460.3413  460.3413 
     1366      1374      1383      1386      1639      1645      1648      1660 
 460.3413  460.3413  283.5620  283.5620  283.5620  460.3413  460.3413  460.3413 
     1671      1934      1950      1952      1957      2304      2305      2310 
 283.5620  283.5620  460.3413  460.3413  460.3413  460.3413  283.5620  460.3413 
     2312      2364      2370      2381      2385      2387      2716      2717 
 460.3413  460.3413  460.3413  283.5620  460.3413  460.3413  460.3413  460.3413 
     2725      2726      2731      2737      3413      3422      3857      3873 
 460.3413  460.3413  460.3413  283.5620  460.3413  283.5620  283.5620  460.3413 
     3889      3904      4257      4313      4648      4649      4666      4667 
 283.5620  460.3413  283.5620  460.3413  460.3413  460.3413  460.3413  460.3413 
     4685      4703      5027      5041      5358      5371      5654      5655 
 460.3413  283.5620  283.5620  283.5620  283.5620  460.3413  283.5620  283.5620 
     5659      5660      5662      5663      5664      5671      5673      5674 
 283.5620  460.3413  283.5620  283.5620  283.5620  283.5620  283.5620  283.5620 
     5676      5679      5680      5682      5684      5686      5689      5690 
 460.3413  460.3413  460.3413  460.3413  460.3413  460.3413  283.5620  283.5620 
     5692      5696      5708      5709      5710      5711      5712      5715 
 283.5620  283.5620  283.5620  460.3413  283.5620  460.3413  283.5620  460.3413 
     5718      5722      5724      5726      5727      5728      6095      6427 
 460.3413  283.5620  460.3413  460.3413  283.5620  283.5620  460.3413  460.3413 
     6442      6446      6467      6787      6790      6795      7514      7867 
 460.3413  283.5620  460.3413  460.3413  283.5620  460.3413  460.3413  460.3413 
     7876      7913      8243      8244      8245      8246      8247      8248 
 460.3413  460.3413  460.3413  460.3413  460.3413  283.5620  283.5620  460.3413 
     8249      8250      8251      8252      8253      8254      8255      8256 
 460.3413  460.3413  283.5620  283.5620  283.5620  283.5620  283.5620  460.3413 
     8257      8258      8259      8260      8261      8262      8263      8264 
 460.3413  460.3413  460.3413  283.5620  460.3413  283.5620  283.5620  460.3413 
     8265      8266      8267      8268      8269      8270      8271      8272 
 283.5620  283.5620  283.5620  283.5620  283.5620  460.3413  283.5620  460.3413 
     8273      8274      8275      8276      8277      8278      8279      8280 
 283.5620  283.5620  283.5620  283.5620  460.3413  460.3413  460.3413  283.5620 
     8281      8282      8283      8284      8285      8286      8287      8288 
 460.3413  283.5620  460.3413  460.3413  283.5620  283.5620  460.3413  460.3413 
     8289      8290      8291      8292      8293      8294      8295      8296 
 283.5620  460.3413  283.5620  460.3413  460.3413  460.3413  460.3413  283.5620 
     8297      8298      8299      8300      8301      8302      8303      8304 
 460.3413  283.5620  460.3413  460.3413  460.3413  283.5620  460.3413  460.3413 
     8305      8306      8307      8308      8309      8310      8311      8312 
 283.5620  283.5620  283.5620  460.3413  460.3413  460.3413  283.5620  460.3413 
     8313      8314      8315      8316      8317      8318      8319      8320 
 460.3413  460.3413  283.5620  283.5620  460.3413  283.5620  283.5620  460.3413 
     8321      8322      8323      8324      8325 
 283.5620  460.3413  283.5620  460.3413  283.5620 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict responses across a range of ages</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remember that our model uses the square root of ages, so we need to transform our predictor</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>xvals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="fl">0.1</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>p.f <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">0</span>), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p.f <span class="sc">~</span> xvals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>p.m <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">1</span>), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p.m <span class="sc">~</span> xvals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># typically, we want to visualize our data on the scale that it was collected</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># so, because it is easier for us as humans to visualize age, rather than the square</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co"># root of age, we should plot across that scale</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data=</span>dat, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"red"</span>)[dat<span class="sc">$</span>sex<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.f <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.m <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="confidence-intervals" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="confidence-intervals"><span class="header-section-number">9.3</span> Confidence intervals</h2>
<p>We can never really know the <em>exact</em> value for something, and our parameter estimates have some degree of uncertainty to them. In frequentist statistics, we are assuming that the parameters are fixed and the data are random variables. When we estimate parameters, we are assuming that there is some truth out there in the world, and we are imperfectly estimating it from our observed data. Our data are a random draw from the ‘truth’. We will talk about this in much, much more detail next week. In the meantime, let’s just stick with the general understanding that our estimates aren’t precise, and there is some wobbly room around our predicted values because we aren’t 100% confident in our estimate of the parameter values.</p>
<p>Let’s step back for a bit to thinking about just a single parameter estimate, not a whole bunch of them. To help keep our brain compartmentalized, let’s go to a rather far-fetched example. I have a castle filled with 500 salamanders. I know every salamander by name, and I know exactly how aggressive each salamander is, because I have perfectly curated my population of salamanders to have a mean aggression of 5, and to fit perfectly into a standard normal distribution with a standard deviation of 1 because apparently when I was curating my salamander population I was a little too influenced by Galton.</p>
<p>I have trapped 25 BIOL 431 students in my castle filled with aggressive salamanders, and you can only escape if you can accurately guess how aggressive the average salamander in my population is. Each student can only check the aggressiveness of 15 salamanders before you get too beat up by them, and you aren’t allowed to share your raw data with each other. Because Joe is the TA, you send him out first to battle the salamanders. He comes back and reports that the average salamander he encountered was 5.48 aggressive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>true_mean <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>true_sd <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>true_N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>sample_N <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>joe <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(sample_N, true_mean, true_sd)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(joe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.484234</code></pre>
</div>
</div>
<p>But, there is of course variation in the individual salamanders that Joe measured. We are assuming that the sample he has taken of the salamanders is a random sample of the entire population in the castle. Based on the mean and the standard deviation of the sample he has taken, we want to make inference about the population mean. There is a measure called the standard error, which is equal to <span class="math inline">\(\sigma / \sqrt n\)</span> where <span class="math inline">\(\sigma\)</span> is the standard deviation (the square root of the variance) and <span class="math inline">\(n\)</span> is the sample size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, n){</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  sigma<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">se</span>(<span class="fu">sd</span>(joe), sample_N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2647167</code></pre>
</div>
</div>
<p>Often, this gets reported as the mean plus or minus the SE. We can also convert the SE to a 95% confidence interval. What a 95% confidence interval tells us is that, 95 times out of 100, if we calculated the mean and standard deviation from our sample size it would contain the <em>true</em> population mean (the one that I so perfectly curated in my population of salamanders). To convert from an SE to a 95% confidence interval, we multiply it by 1.96 (going back to Pearson and the convenience of 1.96 being nearly two standard deviations in the standard normal distribution). So, Joe could take the standard deviation and sample size from his adventure into the castle to calculate the 95% confidence interval surrounding his estimate of the population mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>joe_se <span class="ot">&lt;-</span> <span class="fu">se</span>(<span class="fu">sd</span>(joe), sample_N)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(joe) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>joe_se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.003079</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(joe) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>joe_se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.965389</code></pre>
</div>
</div>
<p>This means that if there were 100 BIOL 431 students trapped in the castle and they each calculated things the same way, 95 of their confidence intervals would include the <em>true</em> population mean. Let’s run this in a for-loop to see how it pans out for them, keeping in mind that we are randomly drawing from a distribution so it may be a bit higher or lower on any given simulation run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>ci.est <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">3</span>))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  student <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(sample_N, true_mean, true_sd)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  up<span class="fl">.95</span> <span class="ot">&lt;-</span> <span class="fu">mean</span>(student) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">se</span>(<span class="fu">sd</span>(student), sample_N)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  low<span class="fl">.95</span> <span class="ot">&lt;-</span> <span class="fu">mean</span>(student) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">se</span>(<span class="fu">sd</span>(student), sample_N)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  ci.est[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(low<span class="fl">.95</span>, <span class="fu">mean</span>(student), up<span class="fl">.95</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ci.est[,<span class="dv">2</span>])</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">y0=</span>ci.est[,<span class="dv">1</span>], <span class="at">y1=</span>ci.est[,<span class="dv">3</span>], <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span>true_mean, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(true_mean<span class="sc">&gt;</span>ci.est[,<span class="dv">1</span>] <span class="sc">&amp;</span> true_mean<span class="sc">&lt;</span>ci.est[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
    5    95 </code></pre>
</div>
</div>
<section id="predicting-with-se" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="predicting-with-se"><span class="header-section-number">9.3.1</span> Predicting with SE</h3>
<p>Now, back to the bison. We can add the standard error of our model estimate to our plots to indicated that there is some uncertainty in our estimated values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>p.f.se <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">0</span>), </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se.fit=</span>T)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>p.m.se <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">1</span>), </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se.fit=</span>T)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co"># typically, we want to visualize our data on the scale that it was collected</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="co"># so, because it is easier for us as humans to visualize age, rather than the square</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co"># root of age, we should plot across that scale</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data=</span>dat, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"red"</span>)[dat<span class="sc">$</span>sex<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.f.se<span class="sc">$</span>fit <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.m.se<span class="sc">$</span>fit <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(xvals, <span class="fu">rev</span>(xvals)),</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(p.f.se<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>p.f.se<span class="sc">$</span>se.fit,</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rev</span>(p.f.se<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>p.f.se<span class="sc">$</span>se.fit)), <span class="at">col=</span><span class="st">"#F0F00088"</span>, <span class="at">border=</span>F)</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(xvals, <span class="fu">rev</span>(xvals)),</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(p.m.se<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>p.m.se<span class="sc">$</span>se.fit,</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rev</span>(p.m.se<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>p.m.se<span class="sc">$</span>se.fit)), <span class="at">col=</span><span class="st">"#FF000088"</span>, <span class="at">border=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="extrapolating" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="extrapolating"><span class="header-section-number">9.4</span> Extrapolating</h2>
<p>Because we can predict our model to any value, we can extrapolate outside the realm of values used to fit the model. But, our estimates will be far less certain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>xvals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="fl">0.1</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>p.f.se <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">0</span>), </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se.fit=</span>T)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>p.m.se <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.int, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age.sq=</span><span class="fu">sqrt</span>(xvals), <span class="at">sex=</span><span class="dv">1</span>), </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se.fit=</span>T)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># typically, we want to visualize our data on the scale that it was collected</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="co"># so, because it is easier for us as humans to visualize age, rather than the square</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="co"># root of age, we should plot across that scale</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> age, <span class="at">data=</span>dat, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"red"</span>)[dat<span class="sc">$</span>sex<span class="sc">+</span><span class="dv">1</span>], <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8000</span>))</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.f.se<span class="sc">$</span>fit <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p.m.se<span class="sc">$</span>fit <span class="sc">~</span> (xvals), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(xvals, <span class="fu">rev</span>(xvals)),</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(p.f.se<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>p.f.se<span class="sc">$</span>se.fit,</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rev</span>(p.f.se<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>p.f.se<span class="sc">$</span>se.fit)), <span class="at">col=</span><span class="st">"#F0F00088"</span>, <span class="at">border=</span>F)</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(xvals, <span class="fu">rev</span>(xvals)),</span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(p.m.se<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>p.m.se<span class="sc">$</span>se.fit,</span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rev</span>(p.m.se<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>p.m.se<span class="sc">$</span>se.fit)), <span class="at">col=</span><span class="st">"#FF000088"</span>, <span class="at">border=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="linearmodels_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="bringing-it-all-together" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Bringing it all together</h1>
<p>(for next week) Form a hypothesis Make a prediction Gather data Specify a model Fit the model Evaluate model fit Make inference from your model Make predictions</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./simulation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simulation and Probability</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lab3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab 3: Functions and for loops</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>